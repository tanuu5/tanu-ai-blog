<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠå‹‰å¼·ç”¨é€²æ—ç®¡ç†</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }

        h1,
        h2 {
            color: #333;
        }

        .subject {
            background-color: #fff;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .chapter {
            margin-bottom: 15px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .checkbox-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .time-input {
            width: 40px;
            margin-top: 5px;
        }

        .date,
        .total-time {
            margin-left: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .add-button,
        .delete-button {
            margin-top: 10px;
            padding: 5px 10px;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .add-button {
            background-color: #4CAF50;
        }

        .delete-button {
            background-color: #f44336;
        }

        .add-button:hover {
            background-color: #45a049;
        }

        .delete-button:hover {
            background-color: #d32f2f;
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ« */
        #xp-display {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            margin-top: 5px;
        }

        .progress {
            width: 0;
            height: 20px;
            background-color: #4CAF50;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }

        #xp-display {
            background-color: #2196F3;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            background-color: #BBDEFB;
            border-radius: 5px;
            margin-top: 5px;
        }

        .progress {
            width: 0;
            height: 20px;
            background-color: #FF9800;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }

        #achievements {
            background-color: #FFF;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .achievement {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .achievement-icon {
            width: 30px;
            height: 30px;
            background-color: #FFD700;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        .achievement-locked {
            opacity: 0.5;
        }

        .collapsible {
            background-color: #f1f1f1;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 17px;
            transition: 0.4s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 5px;
        }

        .active,
        .collapsible:hover {
            background-color: #e0e0e0;
        }

        .collapsible:after {
            content: '\002B';
            color: #777;
            font-weight: bold;
            float: right;
            margin-left: 5px;
        }

        .active:after {
            content: "\2212";
        }

        .content {
            padding: 0 18px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background-color: white;
        }

        .achievement-progress {
            font-size: 0.9em;
            color: #667;
        }

        .achievement-icon {
            width: 40px;
            height: 40px;
            background-color: #FFD700;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 20px;
        }

        .manual-check {
            margin-left: auto;
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .manual-check:hover {
            background-color: #45a049;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        #reset-button {
            background-color: #f44336;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #reset-button:hover {
            background-color: #d32f2f;
        }

        /* ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç”¨ã®æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ« */
        #daily-challenge {
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #daily-challenge h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        #daily-challenge p {
            margin: 5px 0;
        }

        #complete-challenge {
            background-color: #FFF;
            color: #4CAF50;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        #complete-challenge:hover {
            background-color: #E8F5E9;
        }

        #complete-challenge:disabled {
            background-color: #A5D6A7;
            color: #FFF;
            cursor: not-allowed;
        }

        /* ã‚¯ã‚¤ãƒƒã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        #quick-nav {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            max-width: 250px;
            transition: all 0.3s ease;
        }

        #quick-nav.collapsed {
            width: 40px;
            overflow: hidden;
        }

        #quick-nav-toggle {
            display: none;
            width: 100%;
            text-align: center;
            cursor: pointer;
            margin-bottom: 10px;
        }

        #quick-nav h3 {
            margin-top: 0;
            margin-bottom: 10px;
            text-align: center;
        }

        #quick-nav ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        #quick-nav li {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #quick-nav a {
            text-decoration: none;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }

        #quick-nav a:hover {
            text-decoration: underline;
        }

        .study-time {
            font-size: 0.8em;
            color: #666;
        }

        @media (max-width: 768px) {
            #quick-nav {
                right: 10px;
            }

            #quick-nav-toggle {
                display: block;
            }

            #quick-nav.collapsed {
                width: 40px;
                height: 40px;
                overflow: hidden;
            }

            #quick-nav.collapsed #quick-nav-toggle {
                margin-bottom: 0;
            }

            #quick-nav.collapsed h3,
            #quick-nav.collapsed ul {
                display: none;
            }
        }
    </style>
</head>

<body>
    <h1>ãŠå‹‰å¼·ç”¨é€²æ—ç®¡ç†</h1>
    <div id="xp-display">
        <h2>ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></h2>
        <p>çµŒé¨“å€¤: <span id="xp">0</span> / <span id="xp-to-next-level">100</span></p>
        <div class="progress-bar">
            <div class="progress" id="xp-progress"></div>
        </div>
    </div>
    <div id="daily-challenge">
        <!-- ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®å†…å®¹ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
    </div>
    <div id="achievements">
        <button class="collapsible">
            å®Ÿç¸¾
            <span class="achievement-progress">0 / 0</span>
        </button>
        <div class="content">
            <!-- å®Ÿç¸¾ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
        </div>
    </div>
    <div id="subjects"></div>
    <div class="button-container">
        <button id="add-subject" class="add-button">æ–°ã—ã„ç§‘ç›®ã‚’è¿½åŠ </button>
        <button id="reset-button">ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–</button>
    </div>

    <!-- ã‚¯ã‚¤ãƒƒã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div id="quick-nav">
        <div id="quick-nav-toggle">&gt;&gt;</div>
        <h3>ç§‘ç›®å</h3>
        <ul id="subject-list"></ul>
    </div>

    <script>
        /**
         * ãŠå‹‰å¼·ç”¨é€²æ—ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
         * 
         * @copyright 2024 ãŸã¬
         * @license MIT
         */

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let subjectsData = [
            {
                name: "Gæ¤œå®š",
                chapters: [
                    { name: "1ç« ", total: 10 },
                    { name: "2ç« ", total: 10 },
                    { name: "3ç« ", total: 10 },
                    { name: "4ç« ", total: 10 },
                    { name: "5ç« ", total: 10 },
                    { name: "6ç« ", total: 10 },
                    { name: "7ç« ", total: 10 },
                    { name: "8ç« ", total: 15 },
                    { name: "9ç« ", total: 10 }
                ]
            },
            {
                name: "åŸºæœ¬æƒ…å ±",
                chapters: [
                    { name: "1ç« ", total: 10 },
                    { name: "2ç« ", total: 10 },
                    { name: "3ç« ", total: 10 },
                    { name: "4ç« ", total: 10 },
                    { name: "5ç« ", total: 10 },
                    { name: "6ç« ", total: 10 },
                    { name: "7ç« ", total: 10 }
                ]
            }
        ];

        let userXP = 0;
        let userLevel = 1;
        let unlockedAchievements = [];

        // å®Ÿç¸¾ã‚·ã‚¹ãƒ†ãƒ ã®å®šç¾©
        const achievements = [
            { id: 'first-check', name: 'åˆã‚ã®ä¸€æ­©', description: 'æœ€åˆã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯', icon: 'ğŸ‰', condition: checkFirstCheckboxAchievement },
            { id: 'level-5', name: 'å‹¤å‹‰ãªå­¦ç¿’è€…', description: 'ãƒ¬ãƒ™ãƒ«5ã«åˆ°é”', icon: 'ğŸ“š', condition: () => checkLevelAchievement(5) },
            { id: 'level-10', name: 'ç†±å¿ƒãªå­¦ç¿’è€…', description: 'ãƒ¬ãƒ™ãƒ«10ã«åˆ°é”', icon: 'ğŸ”¥', condition: () => checkLevelAchievement(10) },
            { id: 'study-streak-7', name: '1é€±é–“ç¶™ç¶š', description: '7æ—¥é€£ç¶šã§å‹‰å¼·', icon: 'ğŸ“…', condition: () => checkStudyStreak(7) },
            { id: 'study-streak-30', name: '1ãƒ¶æœˆç¶™ç¶š', description: '30æ—¥é€£ç¶šã§å‹‰å¼·', icon: 'ğŸ—“ï¸', condition: () => checkStudyStreak(30) },
            { id: 'time-master-100', name: 'ã‚¿ã‚¤ãƒ ãƒã‚¹ã‚¿ãƒ¼100', description: 'åˆè¨ˆå‹‰å¼·æ™‚é–“ãŒ100æ™‚é–“ã‚’è¶…ãˆã‚‹', icon: 'â°', condition: () => checkTotalStudyTime(6000) },
            { id: 'time-master-500', name: 'ã‚¿ã‚¤ãƒ ãƒã‚¹ã‚¿ãƒ¼500', description: 'åˆè¨ˆå‹‰å¼·æ™‚é–“ãŒ500æ™‚é–“ã‚’è¶…ãˆã‚‹', icon: 'â³', condition: () => checkTotalStudyTime(30000) },
            { id: 'subject-complete', name: 'ç§‘ç›®ãƒã‚¹ã‚¿ãƒ¼', description: '1ã¤ã®ç§‘ç›®ã‚’ã™ã¹ã¦å®Œäº†', icon: 'ğŸ†', condition: checkSubjectComplete },
            { id: 'all-subjects-complete', name: 'å…¨ç§‘ç›®åˆ¶è¦‡', description: 'ã™ã¹ã¦ã®ç§‘ç›®ã‚’å®Œäº†', icon: 'ğŸ‘‘', condition: checkAllSubjectsComplete },
            { id: 'early-bird', name: 'æ—©èµ·ãå‹‰å¼·å®¶', description: 'æœ5æ™‚ã‹ã‚‰7æ™‚ã®é–“ã«å‹‰å¼·ã‚’é–‹å§‹', icon: 'ğŸŒ…', condition: checkEarlyBirdStudy },
        ];

        // ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®å®šç¾©
        const dailyChallenges = [
            { description: "ä»Šæ—¥ã¯3ã¤ã®ç« ã‚’å®Œäº†ã—ã‚ˆã†", reward: 50 },
            { description: "åˆè¨ˆ60åˆ†ä»¥ä¸Šå‹‰å¼·ã—ã‚ˆã†", reward: 40 },
            { description: "æ–°ã—ã„ç§‘ç›®ã‚’1ã¤è¿½åŠ ã—ã‚ˆã†", reward: 30 },
            { description: "5ã¤ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å®Œäº†ã—ã‚ˆã†", reward: 25 },
        ];

        /**
         * ç§‘ç›®ã”ã¨ã®åˆè¨ˆå‹‰å¼·æ™‚é–“ã‚’è¨ˆç®—
         */
        function calculateTotalStudyTime(subject) {
            const progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            const subjectProgress = progress[subject.name] || {};
            let totalTime = 0;

            subject.chapters.forEach((chapter, index) => {
                const chapterProgress = subjectProgress[index] || {};
                const chapterTime = (chapterProgress.times || []).reduce((sum, time) => sum + (Number(time) || 0), 0);
                totalTime += chapterTime;
            });

            return totalTime;
        }

        /**
         * ã‚¯ã‚¤ãƒƒã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
         */
        function updateQuickNav() {
            const subjectList = document.getElementById('subject-list');
            subjectList.innerHTML = '';
            subjectsData.forEach((subject, index) => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#subject-${index}`;
                a.textContent = subject.name;
                a.title = subject.name; // ãƒ•ãƒ«ãƒãƒ¼ãƒ ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¨ã—ã¦è¡¨ç¤º
                li.appendChild(a);

                const studyTime = document.createElement('span');
                studyTime.className = 'study-time';
                const totalTime = calculateTotalStudyTime(subject);
                studyTime.textContent = `${totalTime}åˆ†`;
                li.appendChild(studyTime);

                subjectList.appendChild(li);
            });
        }

        /**
         * ã‚¯ã‚¤ãƒƒã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
         */
        function initQuickNavToggle() {
            const quickNav = document.getElementById('quick-nav');
            const toggle = document.getElementById('quick-nav-toggle');
            toggle.addEventListener('click', () => {
                quickNav.classList.toggle('collapsed');
                toggle.textContent = quickNav.classList.contains('collapsed') ? '>>' : '<<';
            });
        }

        /**
         * åˆæœŸåŒ–é–¢æ•°
         */
        function initialize() {
            loadSubjectsData();
            loadXPData();
            loadAchievements();
            renderSubjects();
            renderAchievements();
            updateDailyChallengeDisplay();
            initCollapsible();
            addEventListeners();
            updateQuickNav();
            initQuickNavToggle();

            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿç¸¾ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆåˆæœŸåŒ–ç›´å¾Œã¯é™¤ãï¼‰
            if (JSON.parse(localStorage.getItem('studyProgress'))) {
                checkAchievements();
            }
        }

        /**
         * ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
         */
        function addEventListeners() {
            document.getElementById('add-subject').addEventListener('click', addSubject);
            document.getElementById('reset-button').addEventListener('click', resetLocalStorage);
        }

        /**
         * é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
         */
        function saveProgress(subject, chapter, index, checked, time) {
            let progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            if (!progress[subject]) progress[subject] = {};
            if (!progress[subject][chapter]) progress[subject][chapter] = { checked: [], times: [], date: '' };

            const chapterProgress = progress[subject][chapter];
            updateCheckedStatus(chapterProgress, index, checked);
            updateTimeSpent(chapterProgress, index, time);

            localStorage.setItem('studyProgress', JSON.stringify(progress));
            updateDateDisplay(subject, chapter, chapterProgress.date);
            updateTotalTime(subject, chapter);

            checkAchievements();
            updateQuickNav(); // å‹‰å¼·æ™‚é–“ãŒæ›´æ–°ã•ã‚ŒãŸã¨ãã«ã‚¯ã‚¤ãƒƒã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚æ›´æ–°
        }

        /**
         * ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’æ›´æ–°
         */
        function updateCheckedStatus(chapterProgress, index, checked) {
            if (checked) {
                if (!chapterProgress.checked.includes(index)) {
                    chapterProgress.checked.push(index);
                    chapterProgress.date = new Date().toLocaleDateString();
                    addXP(10); // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚ã«10XPè¿½åŠ 
                }
            } else {
                chapterProgress.checked = chapterProgress.checked.filter(i => i !== index);
                if (chapterProgress.checked.length === 0) {
                    chapterProgress.date = '';
                }
                addXP(-10); // ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ãŸæ™‚ã«10XPæ¸›å°‘
            }
        }

        /**
         * å‹‰å¼·æ™‚é–“ã‚’æ›´æ–°
         */
        function updateTimeSpent(chapterProgress, index, time) {
            const oldTime = Number(chapterProgress.times[index]) || 0;
            const newTime = Number(time) || 0;
            chapterProgress.times[index] = newTime;
            const timeDiff = newTime - oldTime;
            addXP(timeDiff); // æ™‚é–“ã®å·®åˆ†ã ã‘XPã‚’è¿½åŠ ï¼ˆã¾ãŸã¯æ¸›å°‘ï¼‰
        }

        /**
         * æ—¥ä»˜è¡¨ç¤ºã‚’æ›´æ–°
         */
        function updateDateDisplay(subject, chapter, date) {
            const dateSpan = document.querySelector(`span.date[data-subject="${subject}"][data-chapter="${chapter}"]`);
            if (dateSpan) dateSpan.textContent = date;
        }

        /**
         * åˆè¨ˆæ™‚é–“ã‚’æ›´æ–°
         */
        function updateTotalTime(subject, chapter) {
            const progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            const chapterProgress = progress[subject] && progress[subject][chapter];
            const totalTime = chapterProgress ? chapterProgress.times.reduce((sum, time) => sum + (Number(time) || 0), 0) : 0;
            const totalSpan = document.querySelector(`span.total-time[data-subject="${subject}"][data-chapter="${chapter}"]`);
            const chapterData = subjectsData.find(s => s.name === subject).chapters[chapter];
            if (totalSpan) totalSpan.textContent = `åˆè¨ˆæ™‚é–“: ${totalTime}åˆ† / ${chapterData.total}åˆ†`;
        }

        /**
         * ç§‘ç›®ã®HTMLã‚’ä½œæˆ
         */
        function createSubjectHTML(subject, subjectIndex) {
            let html = `<div class="subject" id="subject-${subjectIndex}">
            <div class="subject-header">
                <h2>${subject.name}</h2>
                <button class="delete-button" onclick="deleteSubject(${subjectIndex})">ç§‘ç›®ã‚’å‰Šé™¤</button>
            </div>
            <button class="add-button" onclick="addChapter(${subjectIndex})">æ–°ã—ã„ç« ã‚’è¿½åŠ </button>`;

            subject.chapters.forEach((chapter, chapterIndex) => {
                html += createChapterHTML(subject, subjectIndex, chapter, chapterIndex);
            });

            html += '</div>';
            return html;
        }

        /**
         * ç« ã®HTMLã‚’ä½œæˆ
         */
        function createChapterHTML(subject, subjectIndex, chapter, chapterIndex) {
            const checkboxes = Array(10).fill().map((_, i) => {
                return `
            <div class="checkbox-wrapper">
                <input type="checkbox" class="checkbox" data-subject="${subject.name}" data-chapter="${chapterIndex}" data-index="${i}">
                <input type="number" class="time-input" min="0" value="0" data-subject="${subject.name}" data-chapter="${chapterIndex}" data-index="${i}">
            </div>`;
            }).join('');

            return `<div class="chapter" id="subject-${subjectIndex}-chapter-${chapterIndex}">
            <h3>${chapter.name}</h3>
            <div class="checkbox-container">
                ${checkboxes}
            </div>
            <span class="date" data-subject="${subject.name}" data-chapter="${chapterIndex}"></span>
            <span class="total-time" data-subject="${subject.name}" data-chapter="${chapterIndex}">åˆè¨ˆæ™‚é–“: 0åˆ† / ${chapter.total}åˆ†</span>
            <button class="add-button" onclick="addCheckbox(${subjectIndex}, ${chapterIndex})">ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ </button>
        </div>`;
        }

        /**
         * é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
         */
        function loadProgress() {
            const progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            Object.keys(progress).forEach(subject => {
                Object.keys(progress[subject]).forEach(chapter => {
                    const chapterProgress = progress[subject][chapter];
                    chapterProgress.checked.forEach(index => {
                        const checkbox = document.querySelector(`input[type="checkbox"][data-subject="${subject}"][data-chapter="${chapter}"][data-index="${index}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                    chapterProgress.times.forEach((time, index) => {
                        const timeInput = document.querySelector(`input[type="number"][data-subject="${subject}"][data-chapter="${chapter}"][data-index="${index}"]`);
                        if (timeInput) timeInput.value = time;
                    });
                    const dateSpan = document.querySelector(`span.date[data-subject="${subject}"][data-chapter="${chapter}"]`);
                    if (dateSpan) dateSpan.textContent = chapterProgress.date || '';
                    updateTotalTime(subject, chapter);
                });
            });
        }

        /**
         * ç« ã‚’è¿½åŠ 
         */
        function addChapter(subjectIndex) {
            const chapterName = prompt("æ–°ã—ã„ç« ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š");
            if (chapterName) {
                const chapterTotal = parseInt(prompt("ã“ã®ç« ã®ç›®æ¨™æ™‚é–“ï¼ˆåˆ†ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š", "60")) || 60;
                const newChapter = { name: chapterName, total: chapterTotal };
                subjectsData[subjectIndex].chapters.push(newChapter);
                const subjectElement = document.getElementById(`subject-${subjectIndex}`);
                const chapterIndex = subjectsData[subjectIndex].chapters.length - 1;
                const chapterHTML = createChapterHTML(subjectsData[subjectIndex], subjectIndex, newChapter, chapterIndex);
                subjectElement.insertAdjacentHTML('beforeend', chapterHTML);
                saveSubjectsData();

                // æ–°ã—ã„ç« ã®é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
                let progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
                const subjectName = subjectsData[subjectIndex].name;
                if (!progress[subjectName]) {
                    progress[subjectName] = {};
                }
                progress[subjectName][chapterIndex] = { checked: [], times: [], date: '' };
                localStorage.setItem('studyProgress', JSON.stringify(progress));

                // æ–°ã—ã„ç« ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                const newChapterElement = subjectElement.lastElementChild;
                newChapterElement.querySelectorAll('.checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', handleCheckboxChange);
                });
                newChapterElement.querySelectorAll('.time-input').forEach(timeInput => {
                    timeInput.addEventListener('input', handleTimeInput);
                });
            }
        }

        /**
         * ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
         */
        function addCheckbox(subjectIndex, chapterIndex) {
            const subject = subjectsData[subjectIndex];
            const chapter = subject.chapters[chapterIndex];
            const chapterElement = document.getElementById(`subject-${subjectIndex}-chapter-${chapterIndex}`);
            const checkboxContainer = chapterElement.querySelector('.checkbox-container');
            const newIndex = checkboxContainer.children.length;

            const newCheckboxHTML = `
            <div class="checkbox-wrapper">
                <input type="checkbox" class="checkbox" data-subject="${subject.name}" data-chapter="${chapterIndex}" data-index="${newIndex}">
                <input type="number" class="time-input" min="0" value="0" data-subject="${subject.name}" data-chapter="${chapterIndex}" data-index="${newIndex}">
            </div>`;

            checkboxContainer.insertAdjacentHTML('beforeend', newCheckboxHTML);

            const newCheckbox = checkboxContainer.lastElementChild.querySelector('.checkbox');
            const newTimeInput = checkboxContainer.lastElementChild.querySelector('.time-input');

            newCheckbox.addEventListener('change', handleCheckboxChange);
            newTimeInput.addEventListener('input', handleTimeInput);
        }

        /**
         * ç§‘ç›®ã‚’è¿½åŠ 
         */
        function addSubject() {
            const subjectName = prompt("æ–°ã—ã„ç§‘ç›®ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š");
            if (subjectName) {
                const newSubject = {
                    name: subjectName,
                    chapters: []
                };
                subjectsData.push(newSubject);
                const subjectIndex = subjectsData.length - 1;
                const subjectsContainer = document.getElementById('subjects');
                const subjectHTML = createSubjectHTML(newSubject, subjectIndex);
                subjectsContainer.insertAdjacentHTML('beforeend', subjectHTML);
                saveSubjectsData();

                // æ–°ã—ã„ç§‘ç›®ã®é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
                let progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
                progress[subjectName] = {};
                localStorage.setItem('studyProgress', JSON.stringify(progress));

                checkAchievements();
            }
            updateQuickNav();
        }

        /**
         * ç§‘ç›®ã‚’å‰Šé™¤
         */
        function deleteSubject(subjectIndex) {
            const subject = subjectsData[subjectIndex];
            if (confirm(`æœ¬å½“ã«ã€Œ${subject.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚`)) {
                subjectsData.splice(subjectIndex, 1);
                document.getElementById(`subject-${subjectIndex}`).remove();

                // é€²æ—ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è©²å½“ã®ç§‘ç›®ã‚’å‰Šé™¤
                let progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
                delete progress[subject.name];
                localStorage.setItem('studyProgress', JSON.stringify(progress));

                saveSubjectsData();
                renderSubjects(); // ç§‘ç›®ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå¤‰ã‚ã‚‹ã®ã§ã€å…¨ã¦ã®ç§‘ç›®ã‚’å†æç”»

                checkAchievements();
            }
            updateQuickNav();
        }

        /**
         * ç§‘ç›®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
         */
        function saveSubjectsData() {
            localStorage.setItem('subjectsData', JSON.stringify(subjectsData));
        }

        /**
         * ç§‘ç›®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
         */
        function loadSubjectsData() {
            const savedData = localStorage.getItem('subjectsData');
            if (savedData) {
                subjectsData = JSON.parse(savedData);
            }
        }

        /**
         * ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´ã‚’å‡¦ç†
         */
        function handleCheckboxChange(e) {
            const { subject, chapter, index } = e.target.dataset;
            const timeInput = document.querySelector(`input[type="number"][data-subject="${subject}"][data-chapter="${chapter}"][data-index="${index}"]`);
            saveProgress(subject, chapter, index, e.target.checked, timeInput.value);
        }

        /**
         * æ™‚é–“å…¥åŠ›ã®å¤‰æ›´ã‚’å‡¦ç†
         */
        function handleTimeInput(e) {
            const { subject, chapter, index } = e.target.dataset;
            const checkbox = document.querySelector(`input[type="checkbox"][data-subject="${subject}"][data-chapter="${chapter}"][data-index="${index}"]`);
            saveProgress(subject, chapter, index, checkbox.checked, e.target.value);
        }

        /**
         * ç§‘ç›®ã‚’æç”»
         */
        function renderSubjects() {
            const subjectsContainer = document.getElementById('subjects');
            subjectsContainer.innerHTML = '';
            subjectsData.forEach((subject, index) => {
                subjectsContainer.innerHTML += createSubjectHTML(subject, index);
            });

            document.querySelectorAll('.checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
            });

            document.querySelectorAll('.time-input').forEach(timeInput => {
                timeInput.addEventListener('input', handleTimeInput);
            });

            loadProgress();
        }

        /**
         * XPã‚’è¿½åŠ 
         */
        function addXP(amount) {
            amount = Number(amount) || 0;
            userXP = Math.max(0, userXP + amount);
            checkLevelUp();
            updateXPDisplay();
            saveXPData();
            checkAchievements();
            updateStudyStreak();
        }

        /**
         * ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚’ãƒã‚§ãƒƒã‚¯
         */
        function checkLevelUp() {
            const xpToNextLevel = calculateXPToNextLevel();
            while (userXP >= xpToNextLevel) {
                userXP -= xpToNextLevel;
                userLevel++;
                alert(`ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒ¬ãƒ™ãƒ« ${userLevel} ã«ä¸ŠãŒã‚Šã¾ã—ãŸï¼`);
            }
        }

        /**
         * æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ã«å¿…è¦ãªXPã‚’è¨ˆç®—
         */
        function calculateXPToNextLevel() {
            return Math.floor(100 * Math.pow(1.2, userLevel - 1));
        }

        /**
         * XPè¡¨ç¤ºã‚’æ›´æ–°
         */
        function updateXPDisplay() {
            const xpToNextLevel = calculateXPToNextLevel();
            document.getElementById('level').textContent = userLevel;
            document.getElementById('xp').textContent = Math.floor(userXP);
            document.getElementById('xp-to-next-level').textContent = xpToNextLevel;
            const progressPercentage = (userXP / xpToNextLevel) * 100;
            document.getElementById('xp-progress').style.width = `${progressPercentage}%`;
        }

        /**
         * XPãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
         */
        function saveXPData() {
            localStorage.setItem('userXP', userXP.toString());
            localStorage.setItem('userLevel', userLevel.toString());
        }

        /**
         * XPãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
         */
        function loadXPData() {
            const savedXP = localStorage.getItem('userXP');
            const savedLevel = localStorage.getItem('userLevel');
            if (savedXP !== null) userXP = Number(savedXP) || 0;
            if (savedLevel !== null) userLevel = Number(savedLevel) || 1;
            updateXPDisplay();
        }

        /**
         * å®Ÿç¸¾ã‚’ãƒã‚§ãƒƒã‚¯
         */
        function checkAchievements() {
            let newAchievements = false;
            achievements.forEach(achievement => {
                if (!unlockedAchievements.includes(achievement.id)) {
                    const result = achievement.condition();
                    if (result.success) {
                        unlockAchievement(achievement);
                        newAchievements = true;
                    }
                }
            });
            if (newAchievements) {
                renderAchievements();
            }
        }

        /**
         * å®Ÿç¸¾ã‚’è§£é™¤
         */
        function unlockAchievement(achievement) {
            if (!unlockedAchievements.includes(achievement.id)) {
                unlockedAchievements.push(achievement.id);
                alert(`å®Ÿç¸¾è§£é™¤: ${achievement.name}\n${achievement.description}`);
                saveAchievements();
            } else {
                alert(`å®Ÿç¸¾ã€Œ${achievement.name}ã€ã¯æ—¢ã«è§£é™¤ã•ã‚Œã¦ã„ã¾ã™ã€‚`);
            }
            renderAchievements();
        }

        /**
         * å®Ÿç¸¾ã‚’ä¿å­˜
         */
        function saveAchievements() {
            localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedAchievements));
        }

        /**
         * å®Ÿç¸¾ã‚’èª­ã¿è¾¼ã¿
         */
        function loadAchievements() {
            const savedAchievements = localStorage.getItem('unlockedAchievements');
            if (savedAchievements) {
                unlockedAchievements = JSON.parse(savedAchievements);
            }
        }

        /**
         * å®Ÿç¸¾ã‚’æç”»
         */
        function renderAchievements() {
            const achievementsContainer = document.querySelector('#achievements .content');
            achievementsContainer.innerHTML = '';
            achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${unlockedAchievements.includes(achievement.id) ? '' : 'achievement-locked'}`;
                achievementElement.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div>
                    <strong>${achievement.name}</strong>
                    <p>${achievement.description}</p>
                </div>
                <button class="manual-check">${unlockedAchievements.includes(achievement.id) ? 'å®Ÿç¸¾è§£é™¤æ¸ˆã¿' : 'ãƒã‚§ãƒƒã‚¯'}</button>
            `;
                achievementElement.querySelector('.manual-check').addEventListener('click', (e) => {
                    e.stopPropagation();
                    manualCheckAchievement(achievement);
                });
                achievementsContainer.appendChild(achievementElement);
            });
            updateAchievementProgress();
        }

        /**
         * å®Ÿç¸¾ã®é€²æ—ã‚’æ›´æ–°
         */
        function updateAchievementProgress() {
            const progressElement = document.querySelector('#achievements .achievement-progress');
            progressElement.textContent = `${unlockedAchievements.length} / ${achievements.length}`;
        }

        /**
         * æ‰‹å‹•ã§å®Ÿç¸¾ã‚’ãƒã‚§ãƒƒã‚¯
         */
        async function manualCheckAchievement(achievement) {
            const confirmed = await confirmAchievementUnlock(achievement);
            if (confirmed) {
                unlockAchievement(achievement);
            }
        }

        /**
         * å®Ÿç¸¾è§£é™¤ã®ç¢ºèª
         */
        function confirmAchievementUnlock(achievement) {
            return new Promise((resolve) => {
                let message = `ã“ã®å®Ÿç¸¾ã€Œ${achievement.name}ã€ã‚’è§£é™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n\n${achievement.description}`;
                const result = achievement.condition();
                if (!result.success) {
                    message += `\n\næ³¨æ„: ã“ã®å®Ÿç¸¾ã®æ¡ä»¶ã¯ã¾ã æº€ãŸã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nç†ç”±: ${result.reason}\n\nOKã‚’é¸æŠã™ã‚‹ã¨ã€ã“ã®å®Ÿç¸¾ã¯å¼·åˆ¶çš„ã«è§£é™¤ã•ã‚Œã¾ã™ã€‚`;
                }
                const confirmed = confirm(message);
                resolve(confirmed);
            });
        }

        /**
         * æœ€åˆã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’ç¢ºèª
         */
        function checkFirstCheckboxAchievement() {
            const progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            let isAnyChecked = false;

            for (const subject in progress) {
                for (const chapter in progress[subject]) {
                    if (progress[subject][chapter].checked.length > 0) {
                        isAnyChecked = true;
                        break;
                    }
                }
                if (isAnyChecked) break;
            }

            return { success: isAnyChecked };
        }

        /**
         * ã™ã¹ã¦ã®ç§‘ç›®ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
         */
        function checkAllSubjectsComplete() {
            const progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            if (subjectsData.length === 0) {
                return { success: false, reason: 'ç§‘ç›®ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å°‘ãªãã¨ã‚‚1ã¤ã®ç§‘ç›®ã‚’è¿½åŠ ã—ã€å®Œäº†ã•ã›ã¦ãã ã•ã„ã€‚' };
            }
            const incompleteSubjects = subjectsData.filter(subject => !isSubjectComplete(subject, progress));
            if (incompleteSubjects.length === 0) {
                return { success: true };
            } else {
                const subjectNames = incompleteSubjects.map(s => s.name).join(', ');
                return { success: false, reason: `ä»¥ä¸‹ã®ç§‘ç›®ãŒã¾ã å®Œäº†ã—ã¦ã„ã¾ã›ã‚“: ${subjectNames}` };
            }
        }

        /**
         * ç§‘ç›®ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
         */
        function isSubjectComplete(subject, progress) {
            const subjectProgress = progress[subject.name];
            if (!subjectProgress) return false;

            return subject.chapters.every((chapter, index) => {
                const chapterProgress = subjectProgress[index];
                if (!chapterProgress) return false;

                const totalCheckboxes = 10; // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®æœ€å¤§æ•°
                const checkedBoxes = chapterProgress.checked.length;
                const allTimesEntered = chapterProgress.times.every(time => Number(time) > 0);

                return checkedBoxes === totalCheckboxes && allTimesEntered;
            });
        }

        /**
         * æ—©æœã®å­¦ç¿’ã‚’ãƒã‚§ãƒƒã‚¯
         */
        function checkEarlyBirdStudy() {
            const lastStudyTime = localStorage.getItem('lastStudyTime');
            if (lastStudyTime) {
                const studyTime = new Date(lastStudyTime);
                const hours = studyTime.getHours();
                if (hours >= 5 && hours < 7) {
                    return { success: true };
                } else {
                    return { success: false, reason: 'æœ5æ™‚ã‹ã‚‰7æ™‚ã®é–“ã«å­¦ç¿’ã‚’é–‹å§‹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚' };
                }
            }
            return { success: false, reason: 'å­¦ç¿’è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æœ5æ™‚ã‹ã‚‰7æ™‚ã®é–“ã«å­¦ç¿’ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚' };
        }

        /**
         * å­¦ç¿’ã®é€£ç¶šæ—¥æ•°ã‚’æ›´æ–°
         */
        function updateStudyStreak() {
            const today = new Date().toDateString();
            let studyDates = JSON.parse(localStorage.getItem('studyDates')) || [];

            if (studyDates[studyDates.length - 1] !== today) {
                studyDates.push(today);
                localStorage.setItem('studyDates', JSON.stringify(studyDates));
            }

            // æœ€çµ‚å­¦ç¿’æ™‚é–“ã‚’æ›´æ–°
            localStorage.setItem('lastStudyTime', new Date().toISOString());
        }

        /**
         * å­¦ç¿’ã®é€£ç¶šæ—¥æ•°ã‚’å–å¾—
         */
        function getStudyStreak() {
            const studyDates = JSON.parse(localStorage.getItem('studyDates')) || [];
            if (studyDates.length === 0) return 0;

            let streak = 1;
            let currentDate = new Date(studyDates[studyDates.length - 1]);

            for (let i = studyDates.length - 2; i >= 0; i--) {
                const prevDate = new Date(studyDates[i]);
                const diffDays = (currentDate - prevDate) / (1000 * 60 * 60 * 24);

                if (diffDays === 1) {
                    streak++;
                    currentDate = prevDate;
                } else if (diffDays > 1) {
                    break;
                }
            }

            return streak;
        }

        /**
         * åˆè¨ˆå­¦ç¿’æ™‚é–“ã‚’å–å¾—
         */
        function getTotalStudyTime() {
            let totalTime = 0;
            const progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            Object.values(progress).forEach(subject => {
                Object.values(subject).forEach(chapter => {
                    totalTime += chapter.times.reduce((sum, time) => sum + (Number(time) || 0), 0);
                });
            });
            return totalTime;
        }

        /**
         * ç§‘ç›®ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
         */
        function checkSubjectComplete() {
            const progress = JSON.parse(localStorage.getItem('studyProgress')) || {};
            const completedSubject = subjectsData.find(subject => {
                return subject.chapters.length > 0 && isSubjectComplete(subject, progress);
            });
            if (completedSubject) {
                return { success: true };
            } else {
                return { success: false, reason: 'å®Œäº†ã—ãŸç§‘ç›®ãŒã‚ã‚Šã¾ã›ã‚“ã€‚1ã¤ã®ç§‘ç›®ã®ã™ã¹ã¦ã®ç« ã‚’å®Œäº†ã•ã›ã¦ãã ã•ã„ã€‚' };
            }
        }

        /**
         * æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
         */
        function initCollapsible() {
            var coll = document.getElementsByClassName("collapsible");
            for (var i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function () {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            }
        }

        /**
         * ãƒ¬ãƒ™ãƒ«é”æˆã‚’ãƒã‚§ãƒƒã‚¯
         */
        function checkLevelAchievement(requiredLevel) {
            if (userLevel >= requiredLevel) {
                return { success: true };
            } else {
                return { success: false, reason: `ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ã¯${userLevel}ã§ã™ã€‚ãƒ¬ãƒ™ãƒ«${requiredLevel}ã«åˆ°é”ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚` };
            }
        }

        /**
         * å­¦ç¿’ã®é€£ç¶šæ—¥æ•°ã‚’ãƒã‚§ãƒƒã‚¯
         */
        function checkStudyStreak(requiredDays) {
            const streak = getStudyStreak();
            if (streak >= requiredDays) {
                return { success: true };
            } else {
                return { success: false, reason: `ç¾åœ¨ã®é€£ç¶šå­¦ç¿’æ—¥æ•°ã¯${streak}æ—¥ã§ã™ã€‚${requiredDays}æ—¥é–“é€£ç¶šã§å­¦ç¿’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚` };
            }
        }

        /**
         * åˆè¨ˆå­¦ç¿’æ™‚é–“ã‚’ãƒã‚§ãƒƒã‚¯
         */
        function checkTotalStudyTime(requiredMinutes) {
            const totalTime = getTotalStudyTime();
            if (totalTime >= requiredMinutes) {
                return { success: true };
            } else {
                const remainingMinutes = requiredMinutes - totalTime;
                return { success: false, reason: `ç¾åœ¨ã®ç·å­¦ç¿’æ™‚é–“ã¯${totalTime}åˆ†ã§ã™ã€‚ã‚ã¨${remainingMinutes}åˆ†å­¦ç¿’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚` };
            }
        }

        /**
         * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åˆæœŸåŒ–
         */
        function resetLocalStorage() {
            if (confirm("æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚")) {
                // ã“ã®ã‚¢ãƒ—ãƒªã§ä½¿ç”¨ã—ã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ¼ã‚’ã‚¯ãƒªã‚¢
                localStorage.removeItem('studyProgress');
                localStorage.removeItem('subjectsData');
                localStorage.removeItem('userXP');
                localStorage.removeItem('userLevel');
                localStorage.removeItem('unlockedAchievements');
                localStorage.removeItem('studyDates');
                localStorage.removeItem('lastStudyTime');
                localStorage.removeItem('dailyChallenge');

                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                subjectsData = [
                    {
                        name: "Gæ¤œå®š",
                        chapters: [
                            { name: "1ç« ", total: 10 },
                            { name: "2ç« ", total: 10 },
                            { name: "3ç« ", total: 10 },
                            { name: "4ç« ", total: 10 },
                            { name: "5ç« ", total: 10 },
                            { name: "6ç« ", total: 10 },
                            { name: "7ç« ", total: 10 },
                            { name: "8ç« ", total: 15 },
                            { name: "9ç« ", total: 10 }
                        ]
                    },
                    {
                        name: "åŸºæœ¬æƒ…å ±",
                        chapters: [
                            { name: "1ç« ", total: 10 },
                            { name: "2ç« ", total: 10 },
                            { name: "3ç« ", total: 10 },
                            { name: "4ç« ", total: 10 },
                            { name: "5ç« ", total: 10 },
                            { name: "6ç« ", total: 10 },
                            { name: "7ç« ", total: 10 }
                        ]
                    }
                ];
                userXP = 0;
                userLevel = 1;
                unlockedAchievements = [];

                // ç”»é¢ã‚’æ›´æ–°
                saveSubjectsData();
                renderSubjects();
                updateXPDisplay();
                renderAchievements();
                updateDailyChallengeDisplay();

                alert("ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸã€‚");
            }
        }

        /**
         * ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’å–å¾—
         */
        function getDailyChallenge() {
            const today = new Date().toDateString();
            let challenge = JSON.parse(localStorage.getItem('dailyChallenge'));

            if (!challenge || challenge.date !== today) {
                const randomIndex = Math.floor(Math.random() * dailyChallenges.length);
                challenge = {
                    ...dailyChallenges[randomIndex],
                    date: today,
                    completed: false
                };
                localStorage.setItem('dailyChallenge', JSON.stringify(challenge));
            }

            return challenge;
        }

        /**
         * ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®è¡¨ç¤ºã‚’æ›´æ–°
         */
        function updateDailyChallengeDisplay() {
            const challenge = getDailyChallenge();
            const challengeElement = document.getElementById('daily-challenge');
            challengeElement.innerHTML = `
            <h3>ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <p>${challenge.description}</p>
            <p>å ±é…¬: ${challenge.reward}XP</p>
            <button id="complete-challenge" ${challenge.completed ? 'disabled' : ''}>
                ${challenge.completed ? 'å®Œäº†æ¸ˆã¿' : 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸å®Œäº†'}
            </button>
        `;

            if (!challenge.completed) {
                document.getElementById('complete-challenge').addEventListener('click', completeChallenge);
            }
        }

        /**
         * ãƒãƒ£ãƒ¬ãƒ³ã‚¸å®Œäº†å‡¦ç†
         */
        function completeChallenge() {
            const challenge = getDailyChallenge();
            challenge.completed = true;
            localStorage.setItem('dailyChallenge', JSON.stringify(challenge));
            addXP(challenge.reward);
            updateDailyChallengeDisplay();
            updateXPDisplay();
            alert(`ãƒãƒ£ãƒ¬ãƒ³ã‚¸å®Œäº†ï¼${challenge.reward}XPã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', initialize);

        // å®šæœŸçš„ã«å®Ÿç¸¾ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆ1åˆ†ã”ã¨ï¼‰
        setInterval(checkAchievements, 60000);
    </script>
</body>

</html>