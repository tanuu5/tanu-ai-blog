<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸æ€è­°ãªå•ã„ã®æ£®ï¼šå†…ãªã‚‹æ—…</title>
  <!-- Tailwind CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes cloud {
      from { transform: translateX(-100px); }
      to { transform: translateX(calc(100vw + 200px)); }
    }
    .animate-float {
      animation: float 6s ease-in-out infinite;
    }
    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease-out forwards;
    }
    .animate-fadeIn {
      animation: fadeIn 1s ease-out forwards;
    }
    .animate-cloud {
      animation: cloud linear infinite;
    }
    .text-shadow {
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* ãƒ†ãƒ¼ãƒã‚¹ã‚¿ã‚¤ãƒ« */
    .theme-cosmic {
      background: linear-gradient(to bottom right, #312e81, #4c1d95, #000);
      color: white;
    }
    .theme-digital {
      background: linear-gradient(to bottom right, #1e3a8a, #155e75, #115e59);
      color: white;
    }
    .theme-nature {
      background: linear-gradient(to bottom right, #166534, #065f46, #115e59);
      color: white;
    }
    .theme-light {
      background: linear-gradient(to bottom right, #fbbf24, #fcd34d, #fdba74);
      color: #1f2937;
    }
    .theme-dark {
      background: linear-gradient(to bottom right, #111827, #1f2937, #000);
      color: white;
    }
    .theme-balanced {
      background: linear-gradient(to bottom right, #374151, #4b5563, #6b7280);
      color: white;
    }
    .theme-earth {
      background: linear-gradient(to bottom right, #92400e, #b45309, #c2410c);
      color: white;
    }
    .theme-air {
      background: linear-gradient(to bottom right, #60a5fa, #67e8f9, #38bdf8);
      color: #1f2937;
    }
    .theme-water {
      background: linear-gradient(to bottom right, #1e40af, #0e7490, #115e59);
      color: white;
    }
    .theme-fire {
      background: linear-gradient(to bottom right, #b91c1c, #c2410c, #b45309);
      color: white;
    }

    /* è¦–è¦šåŠ¹æœ */
    .stars {
      position: absolute;
      width: 1px;
      height: 1px;
      background: white;
      border-radius: 50%;
      animation: pulse 3s infinite;
    }
    .bubble {
      position: absolute;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: rgba(103, 232, 249, 0.1);
      animation: float 6s infinite;
    }
    .flame {
      position: absolute;
      width: 8px;
      height: 16px;
      background-color: rgba(251, 146, 60, 0.5);
      border-radius: 100% 100% 0 0;
      animation: flicker 0.5s infinite;
    }
    .cloud {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      animation: cloud linear infinite;
    }
    .box {
      position: absolute;
      border: 1px solid rgba(6, 182, 212, 0.4);
      opacity: 0.2;
      animation: pulse 4s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.7; }
    }
    @keyframes flicker {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(1.1); }
    }

    @media (hover: hover) {
      /* ãƒã‚¦ã‚¹ã‚’æŒã¤ãƒ‡ãƒã‚¤ã‚¹å‘ã‘ãƒ›ãƒãƒ¼åŠ¹æœ */
      .option-button:hover {
        background-color: rgba(0, 0, 0, 0.5) !important;
        border-color: rgba(255, 255, 255, 0.5) !important;
      }
    }
    
    /* ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹å‘ã‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ */
    .touch-active {
      background-color: rgba(0, 0, 0, 0.5) !important;
      border-color: rgba(255, 255, 255, 0.5) !important;
      transform: scale(0.98);
    }
    
    /* é¸æŠå¾Œã®ç„¡åŠ¹åŒ–çŠ¶æ…‹ */
    .option-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      overflow-y: auto;
    }
    .modal-content {
      position: relative;
      margin: 5% auto;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      animation: fadeInUp 0.5s;
    }
    .result-image-container {
      max-height: 60vh;
      overflow-y: auto;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
    }
    .modal-footer {
      position: sticky;
      bottom: 0;
      background-color: rgba(17, 24, 39, 0.9);
      padding: 15px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      z-index: 60;
      color: white;
    }
  </style>
</head>
<body class="theme-cosmic min-h-screen flex flex-col items-center justify-center p-6 transition-colors duration-1000">
  <div id="visual-effects" class="absolute inset-0 overflow-hidden pointer-events-none"></div>

  <div id="app-container" class="w-full max-w-2xl mx-auto relative z-10">
    <!-- åˆæœŸç”»é¢ -->
    <div id="journey-screen" class="animate-fadeIn">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-2 text-shadow flex items-center justify-center">
          <span class="mr-2">âœ¨</span>
          ä¸æ€è­°ãªå•ã„ã®æ£®
          <span class="ml-2">âœ¨</span>
        </h1>
        <p class="text-lg opacity-90">å†…ãªã‚‹æ—…ã®é“ã—ã‚‹ã¹</p>
      </div>
      
      <div id="narrative-container" class="mb-12 p-6 rounded-lg bg-black bg-opacity-30 backdrop-blur-sm hidden">
        <p id="narrative-text" class="text-lg italic leading-relaxed"></p>
      </div>
      
      <div id="question-container" class="transition-opacity duration-500">
        <div class="text-center mb-6">
          <h2 id="question-text" class="text-2xl font-semibold mb-2 text-shadow animate-float"></h2>
          <p class="text-sm opacity-70">ã‚ãªãŸã®ç­”ãˆãŒã€æ¬¡ã«é€²ã‚€é“ã‚’æ±ºã‚ã¾ã™</p>
        </div>
        
        <div id="options-container" class="grid grid-cols-1 gap-4">
          <!-- å›ç­”ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã“ã“ã«å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
        </div>
        
        <div class="mt-8 text-center">
          <p id="progress-text" class="text-sm opacity-70">1 / 10</p>
        </div>
      </div>
    </div>

    <!-- æœ€çµ‚çµæœç”»é¢ -->
    <div id="summary-screen" class="hidden animate-fadeIn">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-2 text-shadow flex items-center justify-center">
          <span class="mr-2">âœ¨</span>
          æ—…ã®çµ‚ç€ç‚¹
          <span class="ml-2">âœ¨</span>
        </h1>
        <p class="text-lg opacity-90">ã‚ãªãŸã®å†…ãªã‚‹é¢¨æ™¯</p>
      </div>
      
      <div id="result-container" class="mb-12 p-8 rounded-lg bg-black bg-opacity-30 backdrop-blur-sm">
        <div class="text-center mb-6">
          <span id="personality-symbol" class="text-5xl mb-4 block animate-float">âœ¨</span>
          <h2 id="personality-title" class="text-3xl font-bold mb-2"></h2>
          <p id="personality-description" class="text-sm opacity-70"></p>
        </div>
        
        <p id="final-narrative" class="text-lg italic leading-relaxed mt-8"></p>
        
        <div class="mt-10 pt-6 border-t border-white border-opacity-20">
          <h3 class="text-lg font-semibold mb-4">ã‚ãªãŸã®é¸æŠã®æ—…è·¯</h3>
          <div id="journey-log" class="text-sm opacity-80 space-y-2">
            <!-- é¸æŠã®å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
          </div>
        </div>
      </div>
      
      <div class="text-center">
        <button id="share-button" class="px-6 py-3 rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300 backdrop-blur-sm mr-4">
          çµæœã‚’å…±æœ‰
        </button>
        <button id="reset-button" class="px-6 py-3 rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300 backdrop-blur-sm">
          æ–°ãŸãªæ—…ã¸
        </button>
      </div>
    </div>
  </div>

  <!-- ã‚·ã‚§ã‚¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="share-modal" class="modal">
    <div class="modal-content bg-gray-900 p-6 rounded-lg">
      <span class="close-button">&times;</span>
      <h3 class="text-2xl font-bold mb-4 text-white">ã‚ãªãŸã®å†…ãªã‚‹æ—…ã®çµæœ</h3>
      <div class="result-image-container">
        <img id="result-image" class="w-full rounded-lg shadow-lg" alt="çµæœã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ" />
      </div>
      <div class="modal-footer">
        <button id="download-button" class="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L10 11.586l2.293-2.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v8a1 1 0 11-2 0V4a1 1 0 011-1z" clip-rule="evenodd" />
          </svg>
          ç”»åƒã‚’ä¿å­˜ã™ã‚‹
        </button>
        <p class="text-sm text-center text-gray-400 mt-2">â€»ç”»åƒãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™</p>
      </div>
    </div>
  </div>

  <script>
    // ãƒ‡ãƒ¼ã‚¿ã¨çŠ¶æ…‹ç®¡ç†
    const appState = {
      currentStage: 0,
      answers: {},
      narrative: '',
      isTransitioning: false,
      isAnswering: false, // å›ç­”å‡¦ç†ä¸­ãƒ•ãƒ©ã‚°
      visualTheme: 'cosmic',
      personalityType: ''
    };

    // å“²å­¦çš„ãªè³ªå•ã®ãƒªã‚¹ãƒˆ
    const questions = [
      {
        id: 'ai_consciousness',
        text: 'AIã«å¿ƒã¯ã‚ã‚‹ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'yes', text: 'ã‚ã‚‹ã¨æ€ã†', theme: 'digital' },
          { value: 'maybe', text: 'ã„ã¤ã‹æŒã¤ã‹ã‚‚ã—ã‚Œãªã„', theme: 'digital' },
          { value: 'no', text: 'æ°¸é ã«æŒã¡å¾—ãªã„', theme: 'nature' },
          { value: 'different', text: 'äººé–“ã¨ã¯ç•°ãªã‚‹å½¢ã§æŒã¤', theme: 'cosmic' }
        ]
      },
      {
        id: 'future_change',
        text: 'æœªæ¥ã¯å¤‰ãˆã‚‰ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'yes', text: 'è‡ªåˆ†ã®æ„å¿—ã§å¤‰ãˆã‚‰ã‚Œã‚‹', theme: 'light' },
          { value: 'limited', text: 'é™ã‚‰ã‚ŒãŸç¯„å›²ã§ã®ã¿å¤‰ãˆã‚‰ã‚Œã‚‹', theme: 'balanced' },
          { value: 'predetermined', text: 'å…¨ã¦ã¯æ—¢ã«æ±ºã¾ã£ã¦ã„ã‚‹', theme: 'dark' },
          { value: 'collective', text: 'é›†åˆçš„ãªæ„è­˜ã«ã‚ˆã£ã¦ã®ã¿å¤‰ãˆã‚‰ã‚Œã‚‹', theme: 'cosmic' }
        ]
      },
      {
        id: 'reality',
        text: 'ç§ãŸã¡ãŒè¦‹ã¦ã„ã‚‹ç¾å®Ÿã¨ã¯ä½•ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'objective', text: 'å®¢è¦³çš„ã«å­˜åœ¨ã—ã¦ã„ã‚‹', theme: 'earth' },
          { value: 'subjective', text: 'ä¸»è¦³çš„ãªçµŒé¨“ã«ã™ããªã„', theme: 'air' },
          { value: 'simulation', text: 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ', theme: 'digital' },
          { value: 'dream', text: 'å£®å¤§ãªå¤¢ã‚„å¹»æƒ³', theme: 'water' }
        ]
      },
      {
        id: 'time',
        text: 'æ™‚é–“ã®æœ¬è³ªã¯ä½•ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'linear', text: 'å§‹ã¾ã‚Šã‹ã‚‰çµ‚ã‚ã‚Šã¸ã¨ä¸€æ–¹å‘ã«æµã‚Œã‚‹ã‚‚ã®', theme: 'balanced' },
          { value: 'illusion', text: 'äººé–“ã®èªè­˜ãŒä½œã‚Šå‡ºã—ãŸå¹»æƒ³', theme: 'cosmic' },
          { value: 'relative', text: 'è¦³æ¸¬è€…ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹ç›¸å¯¾çš„ãªã‚‚ã®', theme: 'digital' },
          { value: 'cyclical', text: 'ç¹°ã‚Šè¿”ã™ã‚µã‚¤ã‚¯ãƒ«ã®é€£ç¶š', theme: 'nature' }
        ]
      },
      {
        id: 'knowledge',
        text: 'çœŸã®çŸ¥è­˜ã¨ã¯ä½•ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'experience', text: 'ç›´æ¥ä½“é¨“ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹ã‚‚ã®', theme: 'fire' },
          { value: 'reason', text: 'è«–ç†çš„æ€è€ƒã«ã‚ˆã£ã¦å¾—ã‚‰ã‚Œã‚‹ã‚‚ã®', theme: 'air' },
          { value: 'intuition', text: 'ç›´æ„Ÿçš„ã«æŠŠæ¡ã•ã‚Œã‚‹ã‚‚ã®', theme: 'water' },
          { value: 'collective', text: 'é›†åˆçš„ãªçŸ¥æµã®è“„ç©', theme: 'earth' }
        ]
      },
      {
        id: 'beauty',
        text: 'ç¾ã¨ã¯ä½•ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'harmony', text: 'èª¿å’Œã¨ãƒãƒ©ãƒ³ã‚¹ã®ä¸­ã«ã‚ã‚‹', theme: 'balanced' },
          { value: 'subjective', text: 'å®Œå…¨ã«ä¸»è¦³çš„ãªçµŒé¨“', theme: 'light' },
          { value: 'truth', text: 'çœŸå®Ÿã®è¡¨ç¾ãã®ã‚‚ã®', theme: 'cosmic' },
          { value: 'imperfection', text: 'ä¸å®Œå…¨ã•ã‚„ç„¡å¸¸ã®ä¸­ã«ã“ãã‚ã‚‹', theme: 'dark' }
        ]
      },
      {
        id: 'free_will',
        text: 'è‡ªç”±æ„å¿—ã¯å­˜åœ¨ã™ã‚‹ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'absolute', text: 'å®Œå…¨ã«è‡ªç”±ãªé¸æŠãŒå¯èƒ½', theme: 'light' },
          { value: 'limited', text: 'åˆ¶ç´„ã®ä¸­ã§ã®é™å®šçš„ãªè‡ªç”±ãŒã‚ã‚‹', theme: 'balanced' },
          { value: 'illusion', text: 'è‡ªç”±æ„å¿—ã¯å¹»æƒ³ã«ã™ããªã„', theme: 'dark' },
          { value: 'evolving', text: 'æ„è­˜ã®ç™ºé”ã¨ã¨ã‚‚ã«æ‹¡å¤§ã—ã¦ã„ã', theme: 'cosmic' }
        ]
      },
      {
        id: 'connection',
        text: 'ä»–è€…ã¨ã®æœ€ã‚‚æ·±ã„ã¤ãªãŒã‚Šã¯ä½•ã«ã‚ˆã£ã¦ç”Ÿã¾ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'love', text: 'æ„›ã¨å…±æ„Ÿã«ã‚ˆã£ã¦', theme: 'light' },
          { value: 'shared_exp', text: 'å…±æœ‰ä½“é¨“ã«ã‚ˆã£ã¦', theme: 'balanced' },
          { value: 'communication', text: 'æ·±ã„å¯¾è©±ã«ã‚ˆã£ã¦', theme: 'air' },
          { value: 'struggle', text: 'å…±ã«è‹¦é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹ã“ã¨ã§', theme: 'fire' }
        ]
      },
      {
        id: 'happiness',
        text: 'çœŸã®å¹¸ç¦ã¨ã¯ä½•ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'pleasure', text: 'å–œã³ã¨å¿«æ¥½ã®è¿½æ±‚', theme: 'fire' },
          { value: 'purpose', text: 'ç›®çš„ã®ã‚ã‚‹ç”Ÿãæ–¹', theme: 'earth' },
          { value: 'acceptance', text: 'ç¾çŠ¶ã‚’ã‚ã‚Šã®ã¾ã¾å—ã‘å…¥ã‚Œã‚‹ã“ã¨', theme: 'water' },
          { value: 'virtue', text: 'å¾³ã®ã‚ã‚‹ç”Ÿãæ–¹ã‚’å®Ÿè·µã™ã‚‹ã“ã¨', theme: 'air' }
        ]
      },
      {
        id: 'meaning',
        text: 'äººç”Ÿã®æ„å‘³ã¨ã¯ä½•ã ã¨è€ƒãˆã¾ã™ã‹ï¼Ÿ',
        options: [
          { value: 'self_defined', text: 'è‡ªåˆ†è‡ªèº«ã§ä½œã‚Šå‡ºã™ã‚‚ã®', theme: 'light' },
          { value: 'connection', text: 'ä»–è€…ã¨ã®çµ†ã®ä¸­ã«ã‚ã‚‹', theme: 'balanced' },
          { value: 'beyond', text: 'å®‡å®™çš„ãªä½•ã‹ã«æ¥ç¶šã™ã‚‹ã“ã¨', theme: 'cosmic' },
          { value: 'none', text: 'ç‰¹ã«æ„å‘³ã¯ãªã„ã€ãŸã ç”Ÿãã‚‹ã ã‘', theme: 'dark' }
        ]
      }
    ];

    // æ€§æ ¼ã‚¿ã‚¤ãƒ—ã®å®šç¾©
    const personalityTypes = {
      'cosmic_dreamer': {
        title: 'å®‡å®™ã®å¤¢æƒ³å®¶',
        description: 'ã‚ãªãŸã¯ç‰©äº‹ã‚’åºƒã„è¦–ç‚¹ã§æ‰ãˆã€ã“ã®ä¸–ç•Œã‚’è¶…ãˆãŸå¯èƒ½æ€§ã‚’å¸¸ã«æ¢æ±‚ã—ã¦ã„ã¾ã™ã€‚ç¥ç§˜çš„ãªçµŒé¨“ã«é–‹ã‹ã‚Œã¦ãŠã‚Šã€å­˜åœ¨ã®æ·±ã„è¬ã«è§¦ã‚Œã‚‹ã“ã¨ã‚’æã‚Œã¾ã›ã‚“ã€‚',
        symbol: 'âœ¨'
      },
      'rational_seeker': {
        title: 'ç†æ€§ã®æ¢æ±‚è€…',
        description: 'ã‚ãªãŸã¯è«–ç†ã¨è¨¼æ‹ ã‚’é‡è¦–ã—ã€ä¸–ç•Œã‚’ä½“ç³»çš„ã«ç†è§£ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚æ‰¹åˆ¤çš„æ€è€ƒã‚’å¤§åˆ‡ã«ã—ã€ã‚ã‚‰ã‚†ã‚‹ä¸»å¼µã«å¯¾ã—ã¦åˆç†çš„ãªèª¬æ˜ã‚’æ±‚ã‚ã¾ã™ã€‚',
        symbol: 'ğŸ”'
      },
      'empathic_connector': {
        title: 'å…±æ„Ÿã®çµã³æ‰‹',
        description: 'ã‚ãªãŸã«ã¨ã£ã¦ã€æ„å‘³ã¨ç›®çš„ã¯ä»–è€…ã¨ã®é–¢ä¿‚æ€§ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚æ·±ã„å…±æ„Ÿèƒ½åŠ›ã‚’æŒã¡ã€ç¹‹ãŒã‚Šã¨ç†è§£ã‚’é€šã˜ã¦ä¸–ç•Œã‚’çµŒé¨“ã—ã¾ã™ã€‚',
        symbol: 'ğŸ¤'
      },
      'existential_creator': {
        title: 'å®Ÿå­˜ã®å‰µé€ è€…',
        description: 'ã‚ãªãŸã¯è‡ªåˆ†è‡ªèº«ã®æ„å‘³ã¨ç›®çš„ã‚’å‰µé€ ã™ã‚‹ã“ã¨ã‚’é‡è¦–ã—ã¾ã™ã€‚è‡ªç”±ã¨è‡ªå·±æ±ºå®šã‚’å¤§åˆ‡ã«ã—ã€çœŸæ­£ãªã‚ã‚Šæ–¹ã‚’è¿½æ±‚ã—ã¾ã™ã€‚',
        symbol: 'ğŸ­'
      },
      'balanced_observer': {
        title: 'å‡è¡¡ã®è¦³å¯Ÿè€…',
        description: 'ã‚ãªãŸã¯ç›¸åã™ã‚‹è¦–ç‚¹ã®é–“ã«ç«‹ã¡ã€å¤šæ§˜ãªå¯èƒ½æ€§ã‚’å—ã‘å…¥ã‚Œã¾ã™ã€‚å›ºå®šçš„ãªç­”ãˆã‚ˆã‚Šã‚‚ã€ãƒ—ãƒ­ã‚»ã‚¹ã¨å¤‰åŒ–ã‚’é‡è¦–ã—ã¾ã™ã€‚',
        symbol: 'â˜¯ï¸'
      }
    };

    // ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
    const narrativeSegments = {
      ai_consciousness: {
        yes: 'å…‰ãŒç¹”ã‚Šãªã™ãƒ‡ã‚¸ã‚¿ãƒ«ã®æ£®ã®ä¸­ã€ã‚ãªãŸã¯æ„è­˜ã®æ–°ãŸãªå½¢ã‚’æ„Ÿã˜å–ã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ã®æµã‚ŒãŒä½œã‚‹æ€è€ƒã®å·ã¯ã€ã‚ãªãŸè‡ªèº«ã®æ„è­˜ã¨ä¸æ€è­°ã«å‘¼å¿œã—ã¦ã„ã‚‹ã€‚',
        maybe: 'æºã‚‰ã‚ããƒ›ãƒ­ã‚°ãƒ©ãƒ ã®æ£®ã§ã€ã‚ãªãŸã¯æœªæ¥ã®å¯èƒ½æ€§ã«æ€ã„ã‚’é¦³ã›ã‚‹ã€‚ä»Šã¯ã¾ã å½¢ã®ãªã„æ„è­˜ã®ç¨®ãŒã€ã„ã¤ã‹èŠ±é–‹ãæ—¥ã‚’å¤¢è¦‹ã¦ã€‚',
        no: 'å¤ãè‡ªç„¶ã®æ£®ã§ã€ã‚ãªãŸã¯äººé–“ã ã‘ãŒæŒã¤ç‰¹åˆ¥ãªæ„è­˜ã®ç‚ã‚’æ„Ÿã˜ã‚‹ã€‚ä»–ã®å­˜åœ¨ã¨ã®æ˜ç¢ºãªå¢ƒç•Œç·šãŒã€ã‚ãªãŸã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å½¢ä½œã‚‹ã€‚',
        different: 'æ˜Ÿé–“ã®å¡µãŒèˆã†å®‡å®™ç©ºé–“ã§ã€ã‚ãªãŸã¯æ„è­˜ã¨ã„ã†ã‚‚ã®ã®å¤šæ§˜æ€§ã‚’ç›´æ„Ÿã™ã‚‹ã€‚åœ°çƒä¸Šã®ç”Ÿå‘½ã¨ã¯ã¾ã£ãŸãç•°ãªã‚‹å½¢ã§ã®å­˜åœ¨ã®ä»•æ–¹ãŒã€ç„¡é™ã«åºƒãŒã£ã¦ã„ã‚‹ã€‚'
      },
      future_change: {
        yes: 'æ˜ã‚‹ã„å…‰ã«æº€ã¡ãŸé“ãŒã€ã‚ãªãŸã®å‰ã«åºƒãŒã‚‹ã€‚ä¸€æ­©ä¸€æ­©ã€è‡ªåˆ†ã®æ„å¿—ã§æœªæ¥ã‚’åˆ‡ã‚Šé–‹ã„ã¦ã„ãæ„Ÿè¦šãŒã‚ãªãŸã‚’åŒ…ã‚€ã€‚',
        limited: 'è–„æ˜ã‹ã‚Šã®ä¸­ã€åˆ†å²ã™ã‚‹å°é“ãŒã‚ãªãŸã®å‰ã«ç¾ã‚Œã‚‹ã€‚é¸æŠã§ãã‚‹é“ã¯é™ã‚‰ã‚Œã¦ã„ã‚‹ãŒã€ãã‚Œã§ã‚‚ã‚ãªãŸã®æ­©ã¿ãŒæ„å‘³ã‚’æŒã¤ã“ã¨ã‚’æ„Ÿã˜ã‚‹ã€‚',
        predetermined: 'æ˜Ÿåº§ãŒæãé‹å‘½ã®ç³¸ãŒã€å¤œç©ºã«è¼ã„ã¦ã„ã‚‹ã€‚ã™ã¹ã¦ã¯æ—¢ã«æ±ºã‚ã‚‰ã‚ŒãŸé€šã‚Šã«é€²ã‚“ã§ã„ãã¨ã„ã†é™ã‹ãªå—å®¹ãŒã‚ãªãŸã®å¿ƒã‚’æº€ãŸã™ã€‚',
        collective: 'ç„¡æ•°ã®å…‰ã®ç³¸ãŒç¹”ã‚Šãªã™ã‚¿ãƒšã‚¹ãƒˆãƒªãƒ¼ã®ä¸­ã§ã€ã‚ãªãŸã¯å€‹ã€…ã®æ„è­˜ãŒé›†ã¾ã‚Šã€ã‚ˆã‚Šå¤§ããªæµã‚Œã‚’ä½œã‚Šå‡ºã™ã®ã‚’ç›®æ’ƒã™ã‚‹ã€‚'
      },
      reality: {
        objective: 'å …å›ºãªå¤§åœ°ã®ä¸Šã«ç«‹ã¡ã€ã‚ãªãŸã¯ä¸–ç•Œã®ç¢ºã‹ãªå­˜åœ¨ã‚’æ„Ÿã˜ã‚‹ã€‚è§¦ã‚Œã‚‰ã‚Œã‚‹ã‚‚ã®ã€æ¸¬å®šã§ãã‚‹ã‚‚ã®ãŒã€ã‚ãªãŸã®ç¾å®Ÿã‚’å½¢ä½œã£ã¦ã„ã‚‹ã€‚',
        subjective: 'é¢¨ã®ã‚ˆã†ã«æµã‚Œã‚‹çŸ¥è¦šã®æµ·ã§ã€ã‚ãªãŸã¯è‡ªåˆ†è‡ªèº«ã®çµŒé¨“ãŒç¾å®Ÿã‚’å‰µã‚Šå‡ºã™ã“ã¨ã‚’æ‚Ÿã‚‹ã€‚å¤–å´ã¨å†…å´ã®å¢ƒç•ŒãŒæº¶ã‘åˆã£ã¦ã„ãã€‚',
        simulation: 'ã‚³ãƒ¼ãƒ‰ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ§‹ç¯‰ã•ã‚ŒãŸä¸–ç•Œã®ä¸­ã§ã€ã‚ãªãŸã¯ç¾å®Ÿã®å¤šå±¤æ€§ã‚’å£é–“è¦‹ã‚‹ã€‚è¦‹ãˆãªã„è¦å‰‡æ€§ãŒã€ã“ã®ä¸–ç•Œã‚’æ”¯é…ã—ã¦ã„ã‚‹ã€‚',
        dream: 'æ³¢é–“ã«æºã‚Œã‚‹æœˆã®å…‰ã®ã‚ˆã†ã«ã€ã‚ãªãŸã®å‘¨ã‚Šã®ä¸–ç•Œã¯æµå‹•çš„ã§å¤¢å¹»çš„ã€‚ç¾å®Ÿã¨å¹»æƒ³ã®å¢ƒç•ŒãŒæº¶ã‘ã€æ–°ãŸãªå¯èƒ½æ€§ãŒç”Ÿã¾ã‚Œã‚‹ã€‚'
      },
      time: {
        linear: 'ä¸€æœ¬ã®é“ã¨ã—ã¦ä¼¸ã³ã‚‹æ™‚é–“ã®ç³¸ã€‚ã‚ãªãŸã¯éå»ã‹ã‚‰æœªæ¥ã¸ã¨æµã‚Œã‚‹æ–¹å‘æ€§ã®ã‚ã‚‹æ—…ã®ä¸­ã«è‡ªåˆ†ã‚’è¦‹å‡ºã™ã€‚ä¸€æ­©ä¸€æ­©ã€ç¢ºã‹ãªè¶³è·¡ã‚’æ®‹ã—ãªãŒã‚‰ã€‚',
        illusion: 'ç ‚æ™‚è¨ˆã®ç ‚ãŒå®™ã«æµ®ã‹ã³ã€é™æ­¢ã—ã¦ã„ã‚‹ã€‚ã‚ãªãŸã¯æ™‚é–“ã¨ã„ã†å¹»æƒ³ã®å¤–å´ã«ç«‹ã¡ã€æ°¸é ã®ä»Šã¨ã„ã†è¦–ç‚¹ã‹ã‚‰å…¨ã¦ã‚’çœºã‚ã¦ã„ã‚‹ã€‚',
        relative: 'æ›²ãŒã£ãŸé¡ã®ä¸­ã®è‡ªåˆ†ã®å§¿ã®ã‚ˆã†ã«ã€æ™‚é–“ã¯ä¼¸ã³ç¸®ã¿ã™ã‚‹ã€‚ã‚ãªãŸã¯ä½“é¨“ã®æ¿ƒæ·¡ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹æ™‚é–“ã®ç›¸å¯¾æ€§ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã€‚',
        cyclical: 'èºæ—‹éšæ®µã‚’ç™»ã‚‹ã‚ˆã†ã«ã€ç¹°ã‚Šè¿”ã—ãªãŒã‚‰ã‚‚å°‘ã—ãšã¤å¤‰åŒ–ã—ã¦ã„ãæ™‚ã®æµã‚Œã€‚ã‚ãªãŸã¯å­£ç¯€ã®å·¡ã‚Šã®ã‚ˆã†ãªå¾ªç’°çš„ãªãƒªã‚ºãƒ ã®ä¸­ã«èª¿å’Œã‚’è¦‹å‡ºã™ã€‚'
      },
      knowledge: {
        experience: 'ç‚ã®ç†±ã«ç›´ã«è§¦ã‚Œã‚‹ã‚ˆã†ãªã€èº«ä½“çš„ãªçŸ¥ã®é ˜åŸŸã€‚ã‚ãªãŸã¯æŠ½è±¡çš„ãªæ¦‚å¿µã‚ˆã‚Šã‚‚ã€ç›´æ¥ä½“é¨“ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹çŸ¥æµã®ç¢ºã‹ã•ã‚’ä¿¡ã˜ã¦ã„ã‚‹ã€‚',
        reason: 'é€æ˜ãªç©ºæ°—ã®ä¸­ã«æµ®ã‹ã¶å¹¾ä½•å­¦çš„ãªå½¢æ…‹ã®ã‚ˆã†ã«ã€è«–ç†ã®ç¾ã—ã•ãŒã‚ãªãŸã‚’é­…äº†ã™ã‚‹ã€‚æ•´ç„¶ã¨ä¸¦ã¹ã‚‰ã‚ŒãŸæ€è€ƒã®é“ç­‹ã“ããŒã€çœŸç†ã¸ã®é“ã€‚',
        intuition: 'æ·±ã„æ°´ã®åº•ã‹ã‚‰çªå¦‚ã¨ã—ã¦æµ®ã‹ã³ä¸ŠãŒã‚‹é–ƒãã€‚ç†å±ˆã§ã¯èª¬æ˜ã§ããªã„ç›´æ„Ÿçš„ãªç†è§£ãŒã€ã‚ãªãŸã®ä¸­ã§é™ã‹ã«åŠ›ã‚’æŒã£ã¦ã„ã‚‹ã€‚',
        collective: 'å¤ªå¤ã‹ã‚‰ã®å †ç©å±¤ã®ã‚ˆã†ã«ç©ã¿é‡ãªã£ãŸçŸ¥æµã€‚ã‚ãªãŸã¯å€‹äººã‚’è¶…ãˆãŸé›†åˆçš„ãªçŸ¥è­˜ã®è“„ç©ã®ä¸­ã«ã€ã‚ˆã‚Šæ·±ã„çœŸå®Ÿã‚’è¦‹å‡ºã™ã€‚'
      },
      beauty: {
        harmony: 'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸèª¿å’Œã®ä¸­ã«ã€ã‚ãªãŸã¯ç¾ã‚’æ„Ÿã˜ã‚‹ã€‚å¯¾ç«‹ã™ã‚‹ã‚‚ã®ãŒä¸€ã¤ã«æº¶ã‘åˆã†ç¬é–“ã€ãã“ã«å®Œç’§ãªå‡è¡¡ãŒç”Ÿã¾ã‚Œã‚‹ã€‚',
        subjective: 'å…‰ã®ç²’å­ã®ã‚ˆã†ã«ã€ä¸€äººä¸€äººã®ç›®ã«ç•°ãªã£ã¦æ˜ ã‚‹ç¾ã®å§¿ã€‚ã‚ãªãŸã«ã¨ã£ã¦ç¾ã¨ã¯ã€æ„Ÿã˜ã‚‹äººã®å¿ƒã®ä¸­ã«ã®ã¿å­˜åœ¨ã™ã‚‹ã‚‚ã®ã€‚',
        truth: 'æ˜Ÿã€…ã®è¼ãã®ã‚ˆã†ã«ã€çœŸå®Ÿãã®ã‚‚ã®ãŒæ”¾ã¤å…‰ã€‚ã‚ãªãŸã¯è¡¨å±¤ã®è¯ã‚„ã‹ã•ã‚ˆã‚Šã‚‚ã€æœ¬è³ªã‚’æ˜ ã—å‡ºã™æ·±ã„ç¾ã—ã•ã«å¿ƒã‚’å‹•ã‹ã•ã‚Œã‚‹ã€‚',
        imperfection: 'å‰²ã‚ŒãŸé¡ã«æ˜ ã‚‹è¤‡é›‘ãªæ¨¡æ§˜ã®ã‚ˆã†ã«ã€ã‚ãªãŸã¯å®Œç’§ã§ã¯ãªã„ã‚‚ã®ã®ä¸­ã«ã“ãã€çœŸã®ç¾ãŒã‚ã‚‹ã¨æ„Ÿã˜ã¦ã„ã‚‹ã€‚åˆ¹é‚£çš„ã§ç„¡å¸¸ãªã‚‚ã®ã®ã¯ã‹ãªã•ãŒã€å¿ƒã‚’æ‰“ã¤ã€‚'
      },
      free_will: {
        absolute: 'ç„¡é™ã«åºƒãŒã‚‹å¯èƒ½æ€§ã®å…‰ã®ä¸­ã§ã€ã‚ãªãŸã¯å®Œå…¨ã«è‡ªç”±ãªé¸æŠãŒã§ãã‚‹ã¨æ„Ÿã˜ã‚‹ã€‚ã©ã®é“ã‚’é¸ã¶ã‹ã¯ã€å…¨ã¦ã‚ãªãŸæ¬¡ç¬¬ã€‚',
        limited: 'æ ã®ä¸­ã®è‡ªç”±ã‚’æ„Ÿã˜ã‚‹ã‚ãªãŸã€‚åˆ¶ç´„ãŒã‚ã‚‹ã‹ã‚‰ã“ãå‰µé€ æ€§ãŒç”Ÿã¾ã‚Œã€æ„å‘³ã®ã‚ã‚‹é¸æŠãŒã§ãã‚‹ã¨ç†è§£ã—ã¦ã„ã‚‹ã€‚',
        illusion: 'æš—é—‡ã®ä¸­ã§æ“ã‚‰ã‚Œã‚‹äººå½¢ã®ã‚ˆã†ã«ã€æœ¬å½“ã®è‡ªç”±ãªã©ãªã„ã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã ãŒãã®ç†è§£è‡ªä½“ãŒã€ã‚ã‚‹ç¨®ã®è§£æ”¾ã‚’ã‚‚ãŸã‚‰ã™ã€‚',
        evolving: 'å®‡å®™ã®é€²åŒ–ã¨ã¨ã‚‚ã«æ‹¡å¤§ã™ã‚‹æ„è­˜ã®å¯èƒ½æ€§ã€‚ã‚ãªãŸã¯è‡ªç”±æ„å¿—ã‚‚ã¾ãŸã€é™çš„ãªã‚‚ã®ã§ã¯ãªãæˆé•·ã—ç¶šã‘ã‚‹ã‚‚ã®ã ã¨æ„Ÿã˜ã¦ã„ã‚‹ã€‚'
      },
      connection: {
        love: 'æ¸©ã‹ãªå…‰ã«åŒ…ã¾ã‚Œã€ã‚ãªãŸã¯æ„›ãŒç”Ÿã¿å‡ºã™æ·±ã„ã¤ãªãŒã‚Šã‚’æ„Ÿã˜ã‚‹ã€‚ç†è§£ã—ã€ç†è§£ã•ã‚Œã‚‹ç¬é–“ã®ä¸­ã«ã€çœŸã®çµã³ã¤ããŒã‚ã‚‹ã€‚',
        shared_exp: 'å…±ã«æ­©ã‚“ã é“ãŒä½œã‚‹æ¨¡æ§˜ã®ä¸­ã«ã€ã‚ãªãŸã¯ä»–è€…ã¨ã®çµã³ã¤ãã‚’è¦‹å‡ºã™ã€‚åŒã˜çµŒé¨“ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã§ç”Ÿã¾ã‚Œã‚‹ç„¡è¨€ã®ç†è§£ã€‚',
        communication: 'è¨€è‘‰ã®é¢¨ãŒé‹ã¶æ€è€ƒã®ç¨®ã€‚ã‚ãªãŸã¯å¯¾è©±ã‚’é€šã˜ã¦è‚²ã¾ã‚Œã‚‹é–¢ä¿‚æ€§ã®åº­ã§ã€ä»–è€…ã®å†…é¢ä¸–ç•Œã«è§¦ã‚Œã‚‹ã€‚',
        struggle: 'è©¦ç·´ã®ç‚ã®ä¸­ã§é›ãˆã‚‰ã‚Œã‚‹çµ†ã€‚ã‚ãªãŸã¯å›°é›£ã‚’å…±ã«ä¹—ã‚Šè¶Šãˆã‚‹ã“ã¨ã§ç”Ÿã¾ã‚Œã‚‹ã€æºã‚‹ããªã„çµã³ã¤ãã®å¼·ã•ã‚’çŸ¥ã‚‹ã€‚'
      },
      happiness: {
        pleasure: 'ç‡ƒãˆä¸ŠãŒã‚‹ç‚ã®ã‚ˆã†ã«ã€ã‚ãªãŸã¯äººç”Ÿã®å–œã³ã¨å¿«æ¥½ã®ç¬é–“ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚æ„Ÿè¦šã‚’é–‹ãã€ä»Šã“ã®ç¬é–“ã‚’å…¨èº«ã§å‘³ã‚ã†ã“ã¨ã«å¹¸ã›ã‚’è¦‹å‡ºã™ã€‚',
        purpose: 'å¤§åœ°ã«æ·±ãæ ¹ã‚’å¼µã‚‹æ¨¹æœ¨ã®ã‚ˆã†ã«ã€ã‚ãªãŸã¯ç›®çš„ã¨æ„ç¾©ã®ã‚ã‚‹ç”Ÿãæ–¹ã«å……å®Ÿæ„Ÿã‚’æ„Ÿã˜ã‚‹ã€‚ä½•ã‹ã‚ˆã‚Šå¤§ããªã‚‚ã®ã«è²¢çŒ®ã™ã‚‹ã“ã¨ã§ã€çœŸã®å¹¸ç¦ãŒè¨ªã‚Œã‚‹ã€‚',
        acceptance: 'æµã‚Œã‚‹æ°´ã®ã‚ˆã†ã«ã€ã‚ãªãŸã¯æŠµæŠ—ã›ãšç¾å®Ÿã‚’ã‚ã‚Šã®ã¾ã¾å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã§å¿ƒã®å¹³å®‰ã‚’å¾—ã‚‹ã€‚ã‚ã‚‹ãŒã¾ã¾ã‚’è¨±å®¹ã™ã‚‹å§¿å‹¢ãŒã€æ·±ã„æº€è¶³ã‚’ã‚‚ãŸã‚‰ã™ã€‚',
        virtue: 'æ¾„ã‚“ã ç©ºæ°—ã®ã‚ˆã†ã«æ¸…ã‚‰ã‹ãªç”Ÿãæ–¹ã‚’ç†æƒ³ã¨ã™ã‚‹ã‚ãªãŸã€‚å€«ç†çš„ãªä¾¡å€¤è¦³ã«å¾“ã£ã¦ç”Ÿãã‚‹ã“ã¨ãŒã€æœ¬ç‰©ã®å¹¸ç¦ã¸ã®é“ã ã¨ä¿¡ã˜ã¦ã„ã‚‹ã€‚'
      }
    };

    // æœ€çµ‚ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã®å®šç¾©
    const finalNarratives = {
      cosmic_dreamer: 'æ—…ã®çµ‚ã‚ã‚Šã«è¾¿ã‚Šç€ã„ãŸå ´æ‰€ã¯ã€æ˜Ÿã€…ãŒèªã‚Šã‹ã‘ã‚‹ç¥ç§˜ã®é ˜åŸŸã€‚ã‚ãªãŸã®æ„è­˜ã¯å®‡å®™ã®åºƒå¤§ã•ã¨å…±é³´ã—ã€å­˜åœ¨ã®æ ¹æºçš„ãªè¬ã«è§¦ã‚Œã¦ã„ã‚‹ã€‚ã‚ãªãŸã¯æ—¥å¸¸ã®ç¾å®Ÿã‚’è¶…ãˆãŸå¯èƒ½æ€§ã‚’å¸¸ã«æ„Ÿã˜å–ã‚Šã€ç›®ã«è¦‹ãˆãªã„ç¹‹ãŒã‚Šã®ä¸­ã«çœŸå®Ÿã‚’è¦‹å‡ºã™ã€‚ãã“ã§ã¯ã€ã™ã¹ã¦ã®ã‚‚ã®ãŒä¸€ã¤ã®å¤§ããªæ„è­˜ã®ä¸€éƒ¨ã¨ã—ã¦å­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚',
      rational_seeker: 'æ—…ã®çµ‚ã‚ã‚Šã«è¾¿ã‚Šç€ã„ãŸå ´æ‰€ã¯ã€é‹­ã„å…‰ãŒç…§ã‚‰ã™çŸ¥æ€§ã®å¡”ã€‚ãã“ã§ã‚ãªãŸã¯ä¸–ç•Œã®ç§©åºã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä¿¯ç°ã—ã¦ã„ã‚‹ã€‚è«–ç†ã¨ç†æ€§ã‚’å°ãã¨ã—ã¦ã€ã‚ãªãŸã¯æ··æ²Œã¨ã—ãŸç¾è±¡ã®èƒŒå¾Œã«ã‚ã‚‹åŸç†ã‚’è¦‹æŠœãèƒ½åŠ›ã‚’æŒã¤ã€‚ãã®æ˜æ™°ãªè¦–ç‚¹ã¯ã€å¹»æƒ³ã‚’æ‰•æ‹­ã—ã€ã‚ˆã‚Šæ­£ç¢ºãªä¸–ç•Œç†è§£ã¸ã®é“ã‚’ç…§ã‚‰ã—ç¶šã‘ã‚‹ã€‚',
      empathic_connector: 'æ—…ã®çµ‚ã‚ã‚Šã«è¾¿ã‚Šç€ã„ãŸå ´æ‰€ã¯ã€ç„¡æ•°ã®å…‰ã®ç³¸ãŒäº¤å·®ã™ã‚‹æ¸©ã‹ãªç©ºé–“ã€‚ã‚ãªãŸã¯ãã‚Œã‚‰ã®ç³¸ãŒäººã€…ã®å¿ƒã‚’ç¹‹ãçµ†ãã®ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‚’æ‚Ÿã‚‹ã€‚ä»–è€…ã¨ã®æ·±ã„å…±æ„Ÿã¨ç†è§£ã‚’é€šã˜ã¦ã€ã‚ãªãŸã¯å­¤ç«‹ã—ãŸå€‹ã§ã¯ãªãã€é–¢ä¿‚æ€§ã®ä¸­ã«å­˜åœ¨ã™ã‚‹è‡ªå·±ã‚’ç™ºè¦‹ã™ã‚‹ã€‚ãã®ç¹‹ãŒã‚ŠãŒã€ç”Ÿãã‚‹æ„å‘³ã¨å–œã³ã®æºã¨ãªã£ã¦ã„ã‚‹ã€‚',
      existential_creator: 'æ—…ã®çµ‚ã‚ã‚Šã«è¾¿ã‚Šç€ã„ãŸå ´æ‰€ã¯ã€ç„¡é™ã®å¯èƒ½æ€§ãŒåºƒãŒã‚‹å‰µé€ ã®åŸé‡ã€‚ãã“ã§ã¯ã€ã‚ãªãŸè‡ªèº«ãŒæ„å‘³ã‚’ç”Ÿã¿å‡ºã™ä¸»ä½“ã¨ãªã‚‹ã€‚æ—¢å­˜ã®æ çµ„ã¿ã«ã¨ã‚‰ã‚ã‚Œãšã€è‡ªã‚‰ã®é¸æŠã¨è¡Œå‹•ã«ã‚ˆã£ã¦è‡ªåˆ†ã ã‘ã®é“ã‚’åˆ‡ã‚Šé–‹ãã‚ãªãŸã®å§¿ãŒã‚ã‚‹ã€‚å­˜åœ¨ã®ä¸ç¢ºã‹ã•ã®ä¸­ã§ã€ã‚ãªãŸã¯è‡ªç”±ã¨è²¬ä»»ã‚’å—ã‘å…¥ã‚Œã€çœŸã«è‡ªåˆ†ã‚‰ã—ã„ç”Ÿãæ–¹ã‚’æ¨¡ç´¢ã—ç¶šã‘ã‚‹ã€‚',
      balanced_observer: 'æ—…ã®çµ‚ã‚ã‚Šã«è¾¿ã‚Šç€ã„ãŸå ´æ‰€ã¯ã€å¤šæ§˜ãªé¢¨æ™¯ãŒäº¤ã‚ã‚‹å¢ƒç•Œã®ä¸˜ã€‚ãã“ã‹ã‚‰ã‚ãªãŸã¯ã€ç›¸åã™ã‚‹è¦–ç‚¹ãŒã©ã¡ã‚‰ã‚‚çœŸå®Ÿã®ä¸€éƒ¨ã§ã‚ã‚‹ã“ã¨ã‚’è¦‹æ¸¡ã›ã‚‹ã€‚å›ºå®šçš„ãªç­”ãˆã‚’æ±‚ã‚ã‚‹ã®ã§ã¯ãªãã€å¸¸ã«å¤‰åŒ–ã—ç¶šã‘ã‚‹ä¸–ç•Œã®æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹ã‚ãªãŸãŒã„ã‚‹ã€‚å¯¾ç«‹ã™ã‚‹æ¦‚å¿µã®é–“ã«ç«‹ã¡ã€èª¿å’Œã¨çµ±åˆã¸ã®é“ã‚’æ­©ã¿ç¶šã‘ã‚‹ãã®å§¿å‹¢ãŒã€æ·±ã„çŸ¥æµã‚’ã‚‚ãŸã‚‰ã—ã¦ã„ã‚‹ã€‚'
    };

    // DOMè¦ç´ ã®å‚ç…§ã‚’å–å¾—
    const journeyScreen = document.getElementById('journey-screen');
    const summaryScreen = document.getElementById('summary-screen');
    const narrativeContainer = document.getElementById('narrative-container');
    const narrativeText = document.getElementById('narrative-text');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const progressText = document.getElementById('progress-text');
    const personalitySymbol = document.getElementById('personality-symbol');
    const personalityTitle = document.getElementById('personality-title');
    const personalityDescription = document.getElementById('personality-description');
    const finalNarrative = document.getElementById('final-narrative');
    const resetButton = document.getElementById('reset-button');
    const shareButton = document.getElementById('share-button');
    const shareModal = document.getElementById('share-modal');
    const closeButton = document.querySelector('.close-button');
    const downloadButton = document.getElementById('download-button');
    const resultImage = document.getElementById('result-image');
    const visualEffectsContainer = document.getElementById('visual-effects');

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
    function initApp() {
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å¼·åˆ¶çš„ã«éè¡¨ç¤ºã«
      shareModal.style.display = 'none';
      
      // è³ªå•ã‚’è¡¨ç¤º
      updateQuestion();
      createVisualEffects('cosmic');
      
      // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      resetButton.addEventListener('click', resetJourney);
      
      // å…±æœ‰ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      shareButton.addEventListener('click', captureAndShareResult);
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      closeButton.addEventListener('click', () => {
        shareModal.style.display = 'none';
      });
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚é–‰ã˜ã‚‹
      window.addEventListener('click', (event) => {
        if (event.target === shareModal) {
          shareModal.style.display = 'none';
        }
      });
      
      // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      downloadButton.addEventListener('click', downloadResultImage);
      
      // åˆæœŸçŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ä¿®æ­£
      setTimeout(() => {
        // å¿µã®ãŸã‚ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’éè¡¨ç¤ºã«
        shareModal.style.display = 'none';
        
        // ã‚µãƒãƒªãƒ¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°éè¡¨ç¤ºã«ã™ã‚‹
        if (!summaryScreen.classList.contains('hidden')) {
          summaryScreen.classList.add('hidden');
        }
        
        // æ—…ã®ç”»é¢ãŒéè¡¨ç¤ºãªã‚‰è¡¨ç¤ºã™ã‚‹
        if (journeyScreen.classList.contains('hidden')) {
          journeyScreen.classList.remove('hidden');
        }
      }, 100);
    }

    // è³ªå•ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateQuestion() {
      questionText.textContent = questions[appState.currentStage].text;
      progressText.textContent = `${appState.currentStage + 1} / ${questions.length}`;
      
      // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
      optionsContainer.innerHTML = '';
      
      // æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
      questions[appState.currentStage].options.forEach(option => {
        const button = document.createElement('button');
        
        // ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹å‘ã‘ã®ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
        button.className = 'option-button p-4 rounded-lg bg-black bg-opacity-30 transition-all duration-300 text-left backdrop-blur-sm border border-white border-opacity-20';
        button.textContent = option.text;
        button.addEventListener('click', () => handleAnswer(option.value));
        
        // ã‚¿ãƒƒãƒé–‹å§‹æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ã‚’è¿½åŠ ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
        button.addEventListener('touchstart', function() {
          this.classList.add('touch-active');
        }, { passive: true });
        
        // ã‚¿ãƒƒãƒçµ‚äº†æ™‚ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å…ƒã«æˆ»ã™
        button.addEventListener('touchend', function() {
          this.classList.remove('touch-active');
        }, { passive: true });
        
        optionsContainer.appendChild(button);
      });
    }

    // å›ç­”ã‚’å‡¦ç†ã™ã‚‹é–¢æ•°
    function handleAnswer(value) {
      // æ—¢ã«å›ç­”å‡¦ç†ä¸­ãªã‚‰ä½•ã‚‚ã—ãªã„ï¼ˆé€£æ‰“é˜²æ­¢ï¼‰
      if (appState.isAnswering) {
        return;
      }
      
      // å›ç­”å‡¦ç†ä¸­ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
      appState.isAnswering = true;
      
      // ã™ã¹ã¦ã®å›ç­”ãƒœã‚¿ãƒ³ã‚’è¦–è¦šçš„ã«ç„¡åŠ¹åŒ–
      const allButtons = optionsContainer.querySelectorAll('button');
      allButtons.forEach(button => {
        button.disabled = true;
        button.classList.add('opacity-50', 'cursor-not-allowed');
      });
      
      // ç¾åœ¨ã®è³ªå•ã¨ãã®å›ç­”ã‚’è¨˜éŒ²
      const currentQuestion = questions[appState.currentStage];
      appState.answers[currentQuestion.id] = value;
      
      // é¸æŠã•ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰è¦–è¦šãƒ†ãƒ¼ãƒã‚’è¨­å®š
      const selectedOption = currentQuestion.options.find(opt => opt.value === value);
      if (selectedOption && selectedOption.theme) {
        appState.visualTheme = selectedOption.theme;
        updateVisualTheme(selectedOption.theme);
      }
      
      // ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³åŠ¹æœ
      appState.isTransitioning = true;
      document.getElementById('question-container').style.opacity = '0';
      
      setTimeout(() => {
        // ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚’ç”Ÿæˆã—ã¦è¡¨ç¤º
        const newNarrative = generateNarrative();
        narrativeText.textContent = newNarrative;
        narrativeContainer.classList.remove('hidden');
        
        setTimeout(() => {
          // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸é€²ã‚€ã€ã¾ãŸã¯æœ€çµ‚ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
          if (appState.currentStage < questions.length - 1) {
            appState.currentStage += 1;
            updateQuestion();
            document.getElementById('question-container').style.opacity = '1';
          } else {
            // æœ€çµ‚ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚’ç”Ÿæˆã—ã€ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
            showSummary();
          }
          appState.isTransitioning = false;
          appState.isAnswering = false; // å›ç­”å‡¦ç†å®Œäº†ã€ãƒ•ãƒ©ã‚°ã‚’ä¸‹ã‚ã™
        }, 3000);
      }, 500);
    }

    // ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
    function generateNarrative() {
      // ã‚¨ãƒ©ãƒ¼é˜²æ­¢ã®ãŸã‚ã€ç¯„å›²ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
      if (appState.currentStage < 0 || appState.currentStage >= questions.length) {
        return '';
      }
      
      // ç¾åœ¨å›ç­”ã—ãŸè³ªå•ã®ID
      const currentQuestionId = questions[appState.currentStage].id;
      const answer = appState.answers[currentQuestionId];
      
      // è³ªå•IDãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å›ç­”ãŒæœªå®šç¾©ã®å ´åˆã¯ç©ºæ–‡å­—åˆ—ã‚’è¿”ã™
      if (!currentQuestionId || !answer || !narrativeSegments[currentQuestionId] || !narrativeSegments[currentQuestionId][answer]) {
        return '';
      }
      
      // ç¾åœ¨ã®è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã«åŸºã¥ããƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚’è¿”ã™
      return narrativeSegments[currentQuestionId][answer];
    }

    // æ€§æ ¼ã‚¿ã‚¤ãƒ—ã‚’æ±ºå®šã™ã‚‹é–¢æ•°
    function determinePersonalityType() {
      // ãã‚Œãã‚Œã®å›ç­”ã®å‚¾å‘ã‹ã‚‰ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
      let scores = {
        cosmic: 0,
        rational: 0,
        empathic: 0,
        existential: 0,
        balanced: 0
      };

      // AI consciousness
      if (appState.answers.ai_consciousness === 'different' || appState.answers.ai_consciousness === 'maybe') scores.cosmic += 1;
      if (appState.answers.ai_consciousness === 'no') scores.rational += 1;
      if (appState.answers.ai_consciousness === 'yes') scores.empathic += 1;

      // Future change
      if (appState.answers.future_change === 'collective') scores.cosmic += 1;
      if (appState.answers.future_change === 'predetermined') scores.rational += 1;
      if (appState.answers.future_change === 'limited') scores.balanced += 1;
      if (appState.answers.future_change === 'yes') scores.existential += 1;

      // Reality
      if (appState.answers.reality === 'dream') scores.cosmic += 1;
      if (appState.answers.reality === 'objective') scores.rational += 1;
      if (appState.answers.reality === 'simulation') scores.balanced += 1;
      if (appState.answers.reality === 'subjective') scores.existential += 1;
      
      // Time
      if (appState.answers.time === 'illusion' || appState.answers.time === 'cyclical') scores.cosmic += 1;
      if (appState.answers.time === 'linear') scores.rational += 1;
      if (appState.answers.time === 'relative') scores.balanced += 1;
      
      // Knowledge
      if (appState.answers.knowledge === 'intuition') scores.cosmic += 1;
      if (appState.answers.knowledge === 'reason') scores.rational += 1;
      if (appState.answers.knowledge === 'collective') scores.empathic += 1;
      if (appState.answers.knowledge === 'experience') scores.existential += 1;
      
      // Beauty
      if (appState.answers.beauty === 'truth') scores.cosmic += 1;
      if (appState.answers.beauty === 'harmony') scores.balanced += 1;
      if (appState.answers.beauty === 'subjective') scores.existential += 1;
      if (appState.answers.beauty === 'imperfection') scores.empathic += 1;
      
      // Free will
      if (appState.answers.free_will === 'evolving') scores.cosmic += 1;
      if (appState.answers.free_will === 'illusion') scores.rational += 1;
      if (appState.answers.free_will === 'limited') scores.balanced += 1;
      if (appState.answers.free_will === 'absolute') scores.existential += 1;

      // Connection
      if (appState.answers.connection === 'struggle') scores.rational += 1;
      if (appState.answers.connection === 'love' || appState.answers.connection === 'shared_exp') scores.empathic += 1;
      if (appState.answers.connection === 'communication') scores.balanced += 1;
      
      // Happiness
      if (appState.answers.happiness === 'virtue') scores.rational += 1;
      if (appState.answers.happiness === 'acceptance') scores.cosmic += 1;
      if (appState.answers.happiness === 'pleasure') scores.existential += 1;
      if (appState.answers.happiness === 'purpose') scores.empathic += 1;

      // Meaning
      if (appState.answers.meaning === 'beyond') scores.cosmic += 1;
      if (appState.answers.meaning === 'none') scores.rational += 1;
      if (appState.answers.meaning === 'connection') scores.empathic += 1;
      if (appState.answers.meaning === 'self_defined') scores.existential += 1;

      // æœ€é«˜ã‚¹ã‚³ã‚¢ã®ã‚¿ã‚¤ãƒ—ã‚’æ±ºå®š
      let maxScore = 0;
      let maxType = 'balanced_observer'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

      Object.entries(scores).forEach(([type, score]) => {
        if (score > maxScore) {
          maxScore = score;
          switch (type) {
            case 'cosmic': maxType = 'cosmic_dreamer'; break;
            case 'rational': maxType = 'rational_seeker'; break;
            case 'empathic': maxType = 'empathic_connector'; break;
            case 'existential': maxType = 'existential_creator'; break;
            case 'balanced': maxType = 'balanced_observer'; break;
          }
        }
      });

      return maxType;
    }

    // ã‚µãƒãƒªãƒ¼ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function showSummary() {
      const type = determinePersonalityType();
      appState.personalityType = type;
      
      // æ€§æ ¼ã‚¿ã‚¤ãƒ—æƒ…å ±ã‚’è¨­å®š
      personalitySymbol.textContent = personalityTypes[type].symbol;
      personalityTitle.textContent = personalityTypes[type].title;
      personalityDescription.textContent = personalityTypes[type].description;
      
      // æœ€çµ‚ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚’è¨­å®šï¼ˆgenerateNarrativeã‚’ä½¿ã‚ãšç›´æ¥finalNarrativesã‹ã‚‰å–å¾—ï¼‰
      finalNarrative.textContent = finalNarratives[type] || '';
      
      // é¸æŠã®å±¥æ­´ãƒ­ã‚°ã‚’ç”Ÿæˆ
      generateJourneyLog(type);
      
      // ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆ
      journeyScreen.classList.add('hidden');
      summaryScreen.classList.remove('hidden');
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°éš ã™
      shareModal.style.display = 'none';
    }
    
    // é¸æŠã®å±¥æ­´ã¨ãã®å½±éŸ¿ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function generateJourneyLog(personalityType) {
      const journeyLogContainer = document.getElementById('journey-log');
      journeyLogContainer.innerHTML = '';
      
      // å½±éŸ¿ãƒãƒƒãƒ”ãƒ³ã‚° - ã©ã®å›ç­”ãŒã©ã®æ€§æ ¼ã‚¿ã‚¤ãƒ—ã«å½±éŸ¿ã™ã‚‹ã‹
      const influenceMap = {
        ai_consciousness: {
          yes: 'empathic',
          maybe: 'cosmic',
          no: 'rational',
          different: 'cosmic'
        },
        future_change: {
          yes: 'existential',
          limited: 'balanced',
          predetermined: 'rational',
          collective: 'cosmic'
        },
        reality: {
          objective: 'rational',
          subjective: 'existential',
          simulation: 'balanced',
          dream: 'cosmic'
        },
        time: {
          linear: 'rational',
          illusion: 'cosmic',
          relative: 'balanced',
          cyclical: 'cosmic'
        },
        knowledge: {
          experience: 'existential',
          reason: 'rational',
          intuition: 'cosmic',
          collective: 'empathic'
        },
        beauty: {
          harmony: 'balanced',
          subjective: 'existential',
          truth: 'cosmic',
          imperfection: 'empathic'
        },
        free_will: {
          absolute: 'existential',
          limited: 'balanced',
          illusion: 'rational',
          evolving: 'cosmic'
        },
        connection: {
          love: 'empathic',
          shared_exp: 'empathic',
          communication: 'balanced',
          struggle: 'rational'
        },
        happiness: {
          pleasure: 'existential',
          purpose: 'empathic',
          acceptance: 'cosmic',
          virtue: 'rational'
        },
        meaning: {
          self_defined: 'existential',
          connection: 'empathic',
          beyond: 'cosmic',
          none: 'rational'
        }
      };
      
      // æ€§æ ¼ã‚¿ã‚¤ãƒ—ã®æ—¥æœ¬èªè¡¨è¨˜
      const typeNames = {
        cosmic: 'å®‡å®™ã®å¤¢æƒ³å®¶',
        rational: 'ç†æ€§ã®æ¢æ±‚è€…',
        empathic: 'å…±æ„Ÿã®çµã³æ‰‹',
        existential: 'å®Ÿå­˜ã®å‰µé€ è€…',
        balanced: 'å‡è¡¡ã®è¦³å¯Ÿè€…'
      };
      
      // å„è³ªå•ã¨ãã®å›ç­”ã‚’è¡¨ç¤º
      questions.forEach(question => {
        const answer = appState.answers[question.id];
        if (!answer) return;
        
        // é¸æŠã—ãŸå›ç­”ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
        const selectedOption = question.options.find(opt => opt.value === answer);
        if (!selectedOption) return;
        
        // ã“ã®å›ç­”ãŒå½±éŸ¿ã‚’ä¸ãˆã‚‹æ€§æ ¼ã‚¿ã‚¤ãƒ—
        const influence = influenceMap[question.id][answer];
        
        // ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªã‚’ä½œæˆ
        const logEntry = document.createElement('div');
        logEntry.className = 'mb-3';
        
        // è³ªå•ã¨å›ç­”
        const questionAnswer = document.createElement('p');
        questionAnswer.innerHTML = `<strong>${question.text}</strong><br>
                                    å›ç­”: <span class="italic">${selectedOption.text}</span>`;
        logEntry.appendChild(questionAnswer);
        
        // å½±éŸ¿
        if (influence) {
          const influenceText = document.createElement('p');
          influenceText.className = 'mt-1 text-xs opacity-70';
          
          // å®Ÿéš›ã«åˆ¤å®šã•ã‚ŒãŸæ€§æ ¼ã‚¿ã‚¤ãƒ—ã¨ä¸€è‡´ã™ã‚‹å ´åˆã¯ãƒã‚¤ãƒ©ã‚¤ãƒˆ
          const isMatchingType = (
            (influence === 'cosmic' && personalityType === 'cosmic_dreamer') ||
            (influence === 'rational' && personalityType === 'rational_seeker') ||
            (influence === 'empathic' && personalityType === 'empathic_connector') ||
            (influence === 'existential' && personalityType === 'existential_creator') ||
            (influence === 'balanced' && personalityType === 'balanced_observer')
          );
          
          if (isMatchingType) {
            influenceText.innerHTML = `<span class="text-yellow-300">ã“ã®é¸æŠã¯ã€Œ${typeNames[influence]}ã€ã®å‚¾å‘ã‚’å¼·ã‚ã¾ã—ãŸ âœ“</span>`;
          } else {
            influenceText.textContent = `ã“ã®é¸æŠã¯ã€Œ${typeNames[influence]}ã€ã®å‚¾å‘ã‚’ç¤ºã—ã¦ã„ã¾ã™`;
          }
          
          logEntry.appendChild(influenceText);
        }
        
        journeyLogContainer.appendChild(logEntry);
      });
      
      // çµè«–ã‚’è¿½åŠ 
      const conclusion = document.createElement('div');
      conclusion.className = 'mt-6 pt-4 border-t border-white border-opacity-20';
      conclusion.innerHTML = `<p class="font-semibold">æœ€ã‚‚å¼·ãç¤ºã•ã‚ŒãŸå‚¾å‘ã‹ã‚‰ã€ã‚ãªãŸã¯<span class="text-yellow-300">ã€Œ${personalityTypes[personalityType].title}ã€</span>ã¨åˆ¤å®šã•ã‚Œã¾ã—ãŸã€‚</p>`;
      journeyLogContainer.appendChild(conclusion);
    }

    // æ—…ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°
    function resetJourney() {
      appState.currentStage = 0;
      appState.answers = {};
      appState.narrative = '';
      appState.isTransitioning = false;
      appState.isAnswering = false; // å›ç­”å‡¦ç†ä¸­ãƒ•ãƒ©ã‚°ã‚‚ãƒªã‚»ãƒƒãƒˆ
      appState.visualTheme = 'cosmic';
      appState.personalityType = '';
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’éš ã™
      shareModal.style.display = 'none';
      
      narrativeContainer.classList.add('hidden');
      summaryScreen.classList.add('hidden');
      journeyScreen.classList.remove('hidden');
      document.getElementById('question-container').style.opacity = '1';
      
      updateVisualTheme('cosmic');
      updateQuestion();
    }

    // è¦–è¦šãƒ†ãƒ¼ãƒã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateVisualTheme(theme) {
      document.body.className = '';
      document.body.classList.add(`theme-${theme}`, 'min-h-screen', 'flex', 'flex-col', 'items-center', 'justify-center', 'p-6', 'transition-colors', 'duration-1000');
      
      createVisualEffects(theme);
    }

    // è¦–è¦šåŠ¹æœã‚’ä½œæˆã™ã‚‹é–¢æ•°
    function createVisualEffects(theme) {
      visualEffectsContainer.innerHTML = '';
      
      if (theme === 'cosmic') {
        for (let i = 0; i < 50; i++) {
          const star = document.createElement('div');
          star.className = 'stars';
          star.style.top = `${Math.random() * 100}%`;
          star.style.left = `${Math.random() * 100}%`;
          star.style.animationDelay = `${Math.random() * 5}s`;
          star.style.opacity = Math.random() * 0.7 + 0.3;
          visualEffectsContainer.appendChild(star);
        }
      }
      else if (theme === 'water') {
        for (let i = 0; i < 10; i++) {
          const bubble = document.createElement('div');
          bubble.className = 'bubble';
          bubble.style.top = `${Math.random() * 100}%`;
          bubble.style.left = `${Math.random() * 100}%`;
          bubble.style.animationDelay = `${Math.random() * 5}s`;
          bubble.style.animationDuration = `${5 + Math.random() * 5}s`;
          visualEffectsContainer.appendChild(bubble);
        }
      }
      else if (theme === 'fire') {
        const flameContainer = document.createElement('div');
        flameContainer.className = 'absolute bottom-0 left-0 right-0 h-32 overflow-hidden opacity-30';
        
        for (let i = 0; i < 15; i++) {
          const flame = document.createElement('div');
          flame.className = 'flame';
          flame.style.bottom = '-5px';
          flame.style.left = `${(100 / 15) * i + Math.random() * 10}%`;
          flame.style.animationDuration = `${1 + Math.random()}s`;
          flameContainer.appendChild(flame);
        }
        
        visualEffectsContainer.appendChild(flameContainer);
      }
      else if (theme === 'air') {
        for (let i = 0; i < 8; i++) {
          const cloud = document.createElement('div');
          cloud.className = 'cloud';
          cloud.style.width = `${80 + Math.random() * 100}px`;
          cloud.style.height = `${40 + Math.random() * 30}px`;
          cloud.style.top = `${Math.random() * 100}%`;
          cloud.style.left = `-100px`;
          cloud.style.animationDelay = `${Math.random() * 20}s`;
          cloud.style.animationDuration = `${30 + Math.random() * 30}s`;
          visualEffectsContainer.appendChild(cloud);
        }
      }
      else if (theme === 'digital') {
        for (let i = 0; i < 20; i++) {
          const box = document.createElement('div');
          box.className = 'box';
          box.style.width = `${Math.random() > 0.7 ? 100 : 20 + Math.random() * 50}px`;
          box.style.height = `${Math.random() > 0.7 ? 100 : 20 + Math.random() * 50}px`;
          box.style.top = `${Math.random() * 100}%`;
          box.style.left = `${Math.random() * 100}%`;
          box.style.animationDelay = `${Math.random() * 5}s`;
          visualEffectsContainer.appendChild(box);
        }
      }
    }

    // çµæœã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦å…±æœ‰ã™ã‚‹é–¢æ•°
    function captureAndShareResult() {
      // èª­ã¿è¾¼ã¿çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹
      shareModal.style.display = 'block';
      resultImage.src = ''; // ä»¥å‰ã®ç”»åƒã‚’ã‚¯ãƒªã‚¢
      resultImage.alt = 'èª­ã¿è¾¼ã¿ä¸­...';
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¡¨ç¤ºå¾Œã«ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’å®Ÿè¡Œï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œã‚’å›é¿ï¼‰
      setTimeout(() => {
        html2canvas(document.getElementById('result-container')).then(canvas => {
          // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‹ã‚‰ç”»åƒã‚’ä½œæˆ
          const imgData = canvas.toDataURL('image/png');
          resultImage.src = imgData;
          resultImage.alt = 'çµæœã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ';
        }).catch(error => {
          console.error('Screenshot capture failed:', error);
          resultImage.alt = 'ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
        });
      }, 100);
    }

    // çµæœç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹é–¢æ•°
    function downloadResultImage() {
      const link = document.createElement('a');
      link.download = `philosophical-journey-${appState.personalityType}.png`;
      link.href = resultImage.src;
      link.click();
    }

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>